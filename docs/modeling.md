# 零维船用柴油机模型建模与校准方法研究

## 1. 引言

船用柴油机作为大型远洋船舶的主要动力来源，其运行状态的准确预测与监控对于保障船舶安全航行和优化燃油经济性具有重要意义。传统的发动机性能分析方法依赖于试验台架测试，不仅成本高昂，而且难以覆盖所有可能的运行工况。随着计算机技术的快速发展，基于数值仿真的发动机建模方法逐渐成为研究热点。其中，零维（0D）热力学模型因其计算效率高、物理意义明确、参数易于校准等优点，在发动机性能预测、故障诊断和控制策略开发等领域得到了广泛应用。

零维模型的核心思想是将发动机气缸视为一个时变的热力学控制体，忽略缸内气体的空间分布特性，仅考虑其随曲轴转角变化的整体热力学状态。这种简化处理虽然牺牲了部分空间分辨率，但能够以较低的计算成本准确捕捉发动机的主要性能特征，如示功图形态、最大爆发压力、压缩压力和排气温度等关键参数。然而，零维模型的预测精度高度依赖于模型参数的准确性，这就要求必须基于真实的发动机运行数据对模型进行系统性的校准。

本章将详细介绍针对某型二冲程低速船用柴油机开发的零维仿真模型及其校准方法。首先阐述零维模型的理论基础和数学框架，包括发动机几何运动学、燃烧放热规律、缸内传热过程和热力学状态方程的建立；随后提出一种分步解耦的三阶段校准策略，通过对压缩过程、燃烧过程和传热过程的依次独立校准，实现模型参数的有效识别；最后通过与实际监测数据的对比验证模型的预测精度。

## 2. 零维热力学模型理论基础

### 2.1 模型总体框架

零维热力学模型的建立基于经典热力学第一定律和理想气体状态方程。模型将气缸内的工质视为均质混合物，其热力学状态（压力、温度、质量）随曲轴转角的变化通过求解常微分方程组来描述。整个模型框架由四个相互耦合的子模块构成：几何运动学模块负责计算活塞运动和气缸容积变化；燃烧模块采用双Wiebe函数描述燃烧放热规律；传热模块基于Woschni关联式计算缸壁热损失；热力学求解器则将上述模块集成，通过数值积分求解缸内热力学过程。

模型的数学核心是能量守恒方程。对于一个准静态过程，缸内工质在微小曲轴转角$d\theta$内的能量变化可表示为燃烧放热、壁面传热和容积功的代数和。设$U$为缸内工质的内能，$Q_{\text{comb}}$为燃烧放热量，$Q_{\text{wall}}$为壁面传热损失，$W$为工质对外做功，则能量守恒方程为：

$$\frac{dU}{d\theta} = \frac{dQ_{\text{comb}}}{d\theta} - \frac{dQ_{\text{wall}}}{d\theta} - \frac{dW}{d\theta}$$

对于理想气体，内能变化可表示为$dU = m c_v dT$，其中$m$为缸内工质质量，$c_v$为定容比热容，$T$为温度。容积功的微分形式为$dW = p \cdot dV$，其中$p$为缸内压力，$V$为瞬时容积。将这些关系代入能量守恒方程并整理，可得温度对曲轴转角的微分方程。同时，压力通过理想气体状态方程$p = mRT/V$与温度和容积相联系，其中$R$为气体常数。这样，给定初始条件和边界条件，通过数值积分即可求得完整工作循环内的热力学状态变化。

### 2.2 发动机几何运动学模型

发动机几何运动学模型的主要任务是建立活塞位置和气缸容积与曲轴转角之间的数学关系。这一关系是零维模型的基础，因为所有热力学计算都需要用到瞬时气缸容积及其变化率。

对于曲柄连杆机构，活塞相对于上止点的位移可以通过几何分析精确推导。设曲轴半径为$R$（等于行程的一半），连杆长度为$L$，曲轴转角为$\theta$（以上止点为零点），则活塞距上止点的位移$x$为：

$$x = R \left[ (1 - \cos\theta) + \frac{1}{\lambda} \left( 1 - \sqrt{1 - \lambda^2 \sin^2\theta} \right) \right]$$

式中，$\lambda = R/L$为曲柄连杆比，其典型取值范围为0.22至0.30。这一公式精确考虑了连杆的摆动运动对活塞位移的影响。当$\lambda$较小时，可以采用Taylor展开进行简化，但对于大型船用柴油机，由于其行程较长，采用精确公式更为合适。

瞬时气缸容积由余隙容积和活塞位移容积两部分组成。设余隙容积为$V_c$，活塞面积为$A_p = \pi D^2/4$（其中$D$为气缸直径），则瞬时容积为：

$$V(\theta) = V_c + A_p \cdot x(\theta)$$

余隙容积与压缩比$\varepsilon$之间的关系为$V_c = V_s/(\varepsilon - 1)$，其中$V_s = A_p \cdot S$为单缸排量，$S$为活塞行程。压缩比是影响压缩终点压力的关键参数，因此被列为模型校准的首要对象。

容积对曲轴转角的变化率对于热力学计算同样重要，它直接决定了工质对外做功的速率。通过对上述位移表达式求导，可得：

$$\frac{dV}{d\theta} = A_p \cdot R \left[ \sin\theta + \frac{\lambda \sin\theta \cos\theta}{\sqrt{1 - \lambda^2 \sin^2\theta}} \right]$$

此外，对于二冲程柴油机，还需要考虑换气过程的特殊性。二冲程机没有独立的进排气行程，而是通过扫气口和排气阀的协调开闭来完成换气。有效压缩过程从扫气口关闭（或排气阀关闭，取两者中较晚者）时刻开始，此时缸内充满新鲜扫气。模型中定义了扫气口关闭角$\theta_{spc}$、排气阀关闭角$\theta_{evc}$等正时参数来描述这一过程，有效压缩起始角取$\theta_{\text{comp,start}} = \max(\theta_{spc}, \theta_{evc})$。

_【图1插入位置：活塞运动示意图与气缸容积随曲轴转角变化曲线，建议放置于../results/fig_piston_motion.png】_

### 2.3 双Wiebe燃烧放热模型

燃烧放热规律是影响发动机性能的核心因素。对于柴油机，燃烧过程可以分为着火延迟期、预混燃烧期和扩散燃烧期三个阶段。着火延迟期内燃油经历喷射、雾化、蒸发、与空气混合等物理化学准备过程；预混燃烧期以已经形成的可燃混合气快速燃烧为特征，放热速率高、持续时间短；扩散燃烧期则受燃油蒸发和扩散速率控制，放热速率相对平缓但持续时间较长。

Wiebe函数是描述发动机燃烧放热规律的经典经验模型，它以简洁的数学形式捕捉了燃烧过程的本质特征。单Wiebe函数表示累积燃烧分数$x_b$（即已燃燃油质量分数）与曲轴转角的关系：

$$x_b(\theta) = 1 - \exp\left[ -a \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^{m+1} \right]$$

式中，$\theta_{\text{ign}}$为着火角（以上止点后度数计），$\Delta\theta$为燃烧持续角，$m$为形状因子，$a$为效率因子。参数$a$通常取6.908，对应燃烧完成度达到99.9%时$(\theta - \theta_{\text{ign}})/\Delta\theta = 1$。形状因子$m$决定了燃烧放热曲线的形态：较小的$m$值使放热集中于燃烧初期，产生尖锐的放热峰；较大的$m$值则使放热分布更加平缓。

对于大型船用柴油机，由于其燃烧室尺寸大、喷油持续期长，预混燃烧和扩散燃烧具有明显不同的放热特征。因此，本模型采用双Wiebe函数来分别描述这两个燃烧阶段。总累积燃烧分数表示为两个Wiebe函数的加权叠加：

$$x_b^{\text{total}}(\theta) = \beta \cdot x_b^{\text{premix}}(\theta) + (1 - \beta) \cdot x_b^{\text{diffusion}}(\theta)$$

式中，$\beta$为预混燃烧质量分数，对于大型低速柴油机通常在0.10至0.20之间。预混燃烧采用较小的持续角$\Delta\theta_p$（典型值5至12度）和较大的形状因子$m_p$（典型值2至4）；扩散燃烧则采用较大的持续角$\Delta\theta_d$（典型值40至70度）和较小的形状因子$m_d$（典型值0.8至2.0）。这种双Wiebe结构能够很好地反映船用柴油机"快慢结合"的燃烧特点。

瞬时燃烧率通过对累积燃烧分数求导获得：

$$\frac{dx_b}{d\theta} = \frac{a(m+1)}{\Delta\theta} \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^m \exp\left[ -a \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^{m+1} \right]$$

将预混和扩散燃烧的燃烧率加权叠加，即得到总瞬时燃烧率$dx_b^{\text{total}}/d\theta$。

燃烧放热率与燃烧率的关系为：

$$\frac{dQ_{\text{comb}}}{d\theta} = m_f \cdot H_u \cdot \eta_c \cdot \frac{dx_b}{d\theta}$$

式中，$m_f$为循环喷油量，$H_u$为燃油低热值（重质燃料油约为42.7 MJ/kg），$\eta_c$为燃烧效率（通常取0.95至0.99）。

着火角$\theta_{\text{ign}}$由喷油正时和着火延迟共同决定。设喷油正时为$\theta_{\text{inj}}$（以上止点前度数计，取正值），着火延迟为$\tau_{\text{id}}$（度），则：

$$\theta_{\text{ign}} = -\theta_{\text{inj}} + \tau_{\text{id}}$$

着火延迟期的长短与缸内热力学状态密切相关，但在本模型中为简化计算，将其作为常数处理，典型取值为2至5度。这一假设对于稳态工况下的模型精度影响不大，但在瞬态过程仿真中可能需要引入更复杂的着火延迟模型。

_【图2插入位置：双Wiebe燃烧放热率曲线与累积放热曲线，建议放置于../results/fig_wiebe_combustion.png】_

### 2.4 Woschni缸内传热模型

缸内传热损失是影响发动机热效率和排气温度的重要因素。在发动机工作过程中，高温燃气与气缸壁面、活塞顶和气缸盖之间存在着强烈的对流换热。准确计算这一传热过程对于预测发动机热平衡和排气温度具有重要意义。

Woschni传热关联式是目前应用最广泛的发动机缸内对流换热模型。该模型基于湍流对流换热理论，将对流换热系数$h$表示为气缸直径、缸内压力、温度和特征气流速度的函数：

$$h = C \cdot D^{-0.2} \cdot p^{0.8} \cdot T^{-0.53} \cdot w^{0.8}$$

式中，$C$为Woschni系数，是需要校准的关键参数；$D$为气缸直径[m]；$p$为瞬时缸压[kPa]；$T$为瞬时缸温[K]；$w$为特征气流速度[m/s]。

特征气流速度$w$包含两部分：由活塞运动引起的基础气流速度和由燃烧引起的附加湍流速度：

$$w = C_1 C_m + C_2 \frac{V_s T_r}{p_r V_r} (p - p_{\text{mot}})$$

式中，$C_1$为速度系数，在压缩过程取2.28，在燃烧和膨胀过程取2.28（或根据工况调整）；$C_m$为平均活塞速度[m/s]；$C_2$为燃烧附加系数，典型值为$3.24 \times 10^{-3}$；$V_s$为排量；$T_r$、$p_r$、$V_r$分别为参考状态的温度、压力和容积（通常取进气门关闭时刻的状态）；$p_{\text{mot}}$为相同条件下无燃烧时的倒拖压力。

燃烧附加项$(p - p_{\text{mot}})$反映了燃烧引起的压力升高对缸内湍流的增强效应。在燃烧阶段，实际压力高于倒拖压力，这一压差驱动了额外的气体运动，从而加强了对流换热。这是Woschni模型的重要创新之一，它使模型能够区分压缩过程和燃烧过程的不同传热特性。

倒拖压力$p_{\text{mot}}$通过多变压缩过程计算：

$$p_{\text{mot}}(\theta) = p_0 \left( \frac{V_0}{V(\theta)} \right)^n$$

式中，$p_0$和$V_0$分别为压缩起点的压力和容积，$n$为多变指数，对于绝热过程取$\gamma$（比热比），对于有传热损失的实际过程通常取1.30至1.38。

计算得到对流换热系数后，瞬时传热率为：

$$\dot{Q}_{\text{wall}} = h \cdot A_{\text{surf}} \cdot (T - T_{\text{wall}})$$

式中，$A_{\text{surf}}$为气缸受热表面积，包括气缸盖底面、活塞顶面和缸套内壁暴露面积；$T_{\text{wall}}$为等效壁面温度，是气缸盖温度、活塞顶温度和缸套温度的加权平均值。对于船用柴油机，这些壁面温度的典型值分别为：气缸盖500 K、活塞顶550 K、缸套450 K。

将传热率转换到曲轴转角域：

$$\frac{dQ_{\text{wall}}}{d\theta} = \frac{\dot{Q}_{\text{wall}}}{\omega}$$

其中$\omega = 2\pi n/60$为曲轴角速度[rad/s]，$n$为发动机转速[rpm]。

_【图3插入位置：对流换热系数随曲轴转角的变化曲线，建议放置于../results/fig_heat_transfer.png】_

### 2.5 热力学状态方程与ODE求解

综合上述燃烧放热和传热损失模型，结合能量守恒方程，可以建立描述缸内热力学过程的常微分方程组。这一方程组是零维模型的数学核心，通过数值求解即可获得完整工作循环内的压力、温度和质量变化。

能量守恒方程的完整形式为：

$$m c_v \frac{dT}{d\theta} = \frac{dQ_{\text{comb}}}{d\theta} - \frac{dQ_{\text{wall}}}{d\theta} - p \frac{dV}{d\theta}$$

对于封闭系统假设（忽略换气过程和泄漏），质量守恒简化为$dm/d\theta = 0$。但为了模拟气缸泄漏故障，模型中引入了可选的泄漏项：

$$\frac{dm}{d\theta} = -k_{\text{leak}} \cdot \frac{p - p_{\text{crank}}}{\omega}$$

式中，$k_{\text{leak}}$为泄漏因子（正常工况下为0），$p_{\text{crank}}$为曲轴箱压力（约1 bar）。

工质物性参数随燃烧进程而变化。定容比热$c_v$和比热比$\gamma$根据燃烧分数在空气和燃气之间线性插值：

$$\gamma = \gamma_{\text{air}} (1 - x_b) + \gamma_{\text{burned}} \cdot x_b$$

$$c_v = c_{v,\text{air}} (1 - x_b) + c_{v,\text{burned}} \cdot x_b$$

对于空气，$\gamma_{\text{air}} = 1.40$，$c_{v,\text{air}} = 717.5$ J/(kg·K)；对于燃烧产物，$\gamma_{\text{burned}} = 1.30$，$c_{v,\text{burned}} \approx 850$ J/(kg·K)。此外，高温下比热容随温度升高而增加，模型通过经验修正系数$1 + 0.0001(T - 1000)$（当$T > 1000$ K时）来考虑这一效应。

整理能量守恒方程，可得温度对曲轴转角的显式微分形式：

$$\frac{dT}{d\theta} = \frac{1}{m c_v} \left[ \frac{dQ_{\text{comb}}}{d\theta} - \frac{dQ_{\text{wall}}}{d\theta} - p \frac{dV}{d\theta} \right]$$

这是一个一阶常微分方程，与质量守恒方程联立，形成状态向量$\mathbf{y} = [T, m]^T$的ODE系统：

$$\frac{d\mathbf{y}}{d\theta} = \mathbf{f}(\mathbf{y}, \theta)$$

初始条件在有效压缩起点设定。此时缸内充满扫气，温度和压力分别等于扫气温度$T_{\text{scav}}$和扫气压力$p_{\text{scav}}$，初始质量由状态方程计算：

$$m_0 = \frac{p_{\text{scav}} V_0}{R T_{\text{scav}}}$$

式中，$V_0$为压缩起点的气缸容积。

ODE系统采用scipy库中的odeint函数进行数值积分。该函数基于LSODA算法，能够自动在刚性和非刚性求解方法之间切换，适合处理燃烧阶段快速变化的放热过程。积分区间从压缩起点（约235°曲轴转角）延伸到膨胀终点（约125° ATDC），涵盖了完整的压缩、燃烧和膨胀过程。

在每个积分步长内，模型执行以下计算序列：首先根据当前曲轴转角计算几何参数（容积、容积变化率、表面积）；然后调用燃烧模块获取当前燃烧分数和放热率；接着计算倒拖压力并调用传热模块计算换热系数和传热率；最后将所有项代入能量守恒方程计算状态导数。这一序列在整个积分区间内反复执行，最终输出完整的热力学状态历程。

_【图4插入位置：仿真得到的缸内压力和温度随曲轴转角变化曲线（示功图），建议放置于../results/fig_pv_diagram.png】_

## 3. 分步解耦三阶段校准方法

### 3.1 校准问题的提出与策略选择

零维模型虽然在结构上较为简单，但涉及的待校准参数数量仍然较多。这些参数包括几何参数（有效压缩比、连杆比）、燃烧参数（喷油正时、燃烧持续角、形状因子、预混比例）以及传热参数（Woschni系数、壁面温度）等。如果将所有参数同时作为优化变量进行全局优化，将面临以下困难：一是参数空间维度高，搜索效率低下；二是不同参数之间存在耦合效应，可能导致优化陷入局部最优；三是目标函数可能存在多个极值点，全局最优解难以保证。

针对上述问题，本研究提出了一种分步解耦的三阶段校准策略。该策略的核心思想是：根据发动机工作过程的物理特性，将校准过程分解为压缩段校准、燃烧段校准和传热段校准三个相对独立的阶段，每个阶段只调整与该过程最相关的少数参数，从而显著降低每一步优化问题的维度和复杂度。

这种分步策略的物理依据在于：压缩终点压力$P_{\text{comp}}$主要由有效压缩比决定，与燃烧和传热过程几乎无关；最大爆发压力$P_{\text{max}}$虽然受燃烧和传热共同影响，但在确定了压缩参数后，主要由燃烧放热规律控制；排气温度$T_{\text{exh}}$则是燃烧放热和壁面散热平衡的结果，在前两阶段参数确定后，主要通过调整传热系数来匹配。通过这种"依次锁定、逐步精化"的策略，可以有效地将复杂的多参数优化问题转化为若干简单的低维优化问题。

### 3.2 校准数据的获取与预处理

模型校准需要真实的发动机运行数据作为目标值。本研究使用的校准数据来源于某型6缸二冲程低速船用柴油机的运行监测系统。该系统能够实时采集发动机的各项运行参数，包括转速、燃油指令、扫气压力、扫气温度、共轨压力以及各缸的压缩压力、最大爆发压力和排气温度等。

原始监测数据通常包含大量瞬态过渡工况点和测量噪声，直接用于校准可能导致参数识别不准确。因此，数据预处理是校准流程中不可或缺的环节。预处理主要包括以下步骤：

首先是数据清洗，剔除明显异常的数据点。这些异常可能来源于传感器故障、信号干扰或发动机启停过程。通过设定各参数的合理范围（如转速应在额定转速的±20%以内，压力和温度应为正值且不超过物理极限），可以有效识别并排除异常点。

其次是稳态工况筛选。校准应基于稳态运行条件，此时发动机的热力学状态达到准平衡，测量值能够真实反映各参数之间的稳态关系。稳态判别通常采用滑动窗口方法：在一定时间窗口内（如60秒），如果关键参数（如转速、燃油指令）的变化幅度小于设定阈值（如转速变化小于2 rpm），则认为该时段处于稳态。

第三是代表性工况点提取。为了涵盖发动机的典型运行范围，需要从稳态数据中提取若干具有代表性的校准点。这些点应均匀分布在负荷和转速的工作包络内，避免集中于某一特定工况。本研究采用的方法是：将稳态数据按转速分箱，在每个分箱内选取参数最稳定（标准差最小）的若干点作为校准工况。

最后是单位转换和参数关联。监测系统的原始数据可能采用不同的单位制，需要统一转换为国际单位（SI单位）以便于模型计算。例如，压力从bar转换为Pa，温度从℃转换为K。此外，某些参数可能需要通过经验关系式进行转换，如根据燃油指令和转速估算循环喷油量。

经过预处理，最终得到若干稳态校准点。每个校准点包含完整的运行工况信息（$n$, $p_{\text{scav}}$, $T_{\text{scav}}$, $m_f$）和实验测量值（$P_{\text{comp,exp}}$, $P_{\text{max,exp}}$, $T_{\text{exh,exp}}$），这些数据将作为三阶段校准的目标基准。

### 3.3 第一阶段：压缩过程校准

压缩过程校准是三阶段校准的第一步，其目标是确定有效压缩比，使仿真的压缩终点压力与实验值相匹配。这一阶段只涉及压缩过程的模拟，不需要考虑燃烧和复杂的传热计算，因此计算速度快、参数物理意义明确。

压缩终点压力$P_{\text{comp}}$定义为活塞到达上止点时的缸内压力。对于理想的等熵压缩过程，压缩终点压力与压缩比之间存在简单的幂律关系：

$$P_{\text{comp}} = p_0 \left( \frac{V_0}{V_c} \right)^\gamma = p_0 \cdot \varepsilon^\gamma$$

式中，$p_0$为压缩起点压力（近似等于扫气压力），$V_0$为压缩起点容积，$V_c$为余隙容积，$\varepsilon$为压缩比，$\gamma$为比热比。这一关系表明，压缩终点压力对压缩比高度敏感，压缩比的微小变化将导致压缩压力的显著改变。

然而，实际压缩过程并非理想等熵过程，存在壁面传热和可能的泄漏损失，应采用多变过程描述：

$$P_{\text{comp}} = p_0 \cdot \varepsilon^n$$

式中，多变指数$n < \gamma$，其值取决于传热损失程度。对于大型船用柴油机，由于其转速低、压缩行程长，传热损失相对显著，$n$的典型值在1.30至1.38之间。

在校准过程中，由于传热校准在第三阶段进行，此处的"有效压缩比"实际上是一个综合参数，它隐含了几何压缩比和多变指数的耦合效应。这种处理方式的优点是将复杂的压缩过程简化为单参数优化问题，大大提高了校准效率。

校准采用L-BFGS-B算法进行约束优化。目标函数定义为仿真压缩压力与实验值之间的相对误差平方：

$$f_1(\varepsilon) = \left( \frac{P_{\text{comp,sim}}(\varepsilon) - P_{\text{comp,exp}}}{P_{\text{comp,exp}}} \right)^2$$

约束边界根据发动机设计参数和工程经验设定，典型的压缩比搜索范围为11至16。优化迭代过程中，每一步需要运行一次压缩过程仿真以计算目标函数值。由于压缩过程仿真只需求解到上止点，计算量很小，整个优化通常在数十次迭代内收敛。

校准完成后，需要验证结果的有效性。验证方法是使用校准得到的压缩比在多个工况点上计算压缩压力，并与实验值比较。如果所有工况点的相对误差均小于设定阈值（如2%），则认为压缩段校准成功。否则，需要检查数据质量或考虑引入额外参数（如多变指数）进行更精细的校准。

### 3.4 第二阶段：燃烧放热规律校准

在压缩段校准完成并锁定压缩比之后，第二阶段着重于燃烧放热规律的校准。这一阶段的目标是调整双Wiebe燃烧模型的参数，使仿真的最大爆发压力与实验值相匹配。

最大爆发压力$P_{\text{max}}$是衡量发动机燃烧性能的关键指标，它受燃烧放热速率、放热相位和放热量的共同影响。在柴油机中，$P_{\text{max}}$主要取决于以下因素：燃烧起始时刻（由喷油正时和着火延迟决定）、燃烧速率（由Wiebe形状因子控制）以及燃烧持续期。这些因素通过影响压缩上止点附近的放热量和放热速率来决定最大压力的大小和相位。

燃烧段校准的待优化参数包括：喷油正时$\theta_{\text{inj}}$、扩散燃烧持续角$\Delta\theta_d$和扩散燃烧形状因子$m_d$。之所以主要关注扩散燃烧参数，是因为对于大型船用柴油机，扩散燃烧占据了总放热量的绝大部分（通常超过80%），对$P_{\text{max}}$的影响最为显著。预混燃烧参数暂时保持默认值，可以在后续精细调整中进一步优化。

由于燃烧参数的搜索空间相对复杂，存在多个局部最优解的可能性，本研究采用差分进化算法（Differential Evolution, DE）进行全局优化。差分进化是一种基于种群的随机搜索算法，它通过个体之间的差分变异和交叉操作来探索参数空间，具有较强的全局搜索能力和鲁棒性。

目标函数定义为多个校准工况点上$P_{\text{max}}$相对误差的加权平均：

$$f_2(\theta_{\text{inj}}, \Delta\theta_d, m_d) = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{P_{\text{max,sim}}^{(i)} - P_{\text{max,exp}}^{(i)}}{P_{\text{max,exp}}^{(i)}} \right)^2$$

式中，$N$为校准工况点数量，上标$(i)$表示第$i$个工况点。使用多个工况点进行校准可以提高参数的普适性，避免过拟合单一工况。

参数搜索范围根据物理意义和工程经验设定：喷油正时在-5°至10° BTDC之间（负值表示TDC后喷油）；扩散燃烧持续角在30°至80°之间；形状因子在0.5至3.0之间。差分进化算法的种群大小设为参数维度的5至10倍，最大迭代次数设为15至30代。

优化完成后，将最优参数应用于发动机模型，并在所有校准点上验证$P_{\text{max}}$的预测精度。如果平均相对误差小于3%，则认为燃烧段校准成功。需要注意的是，由于忽略了传热损失对$P_{\text{max}}$的影响（传热校准在第三阶段进行），此阶段得到的燃烧参数可能略有偏差，这将在第三阶段通过迭代精化来弥补。

_【图5插入位置：校准前后燃烧放热率曲线对比图，建议放置于../results/fig_combustion_calibration.png】_

### 3.5 第三阶段：传热系数校准

第三阶段针对缸内传热过程进行校准，目标是调整Woschni传热系数，使仿真的排气温度与实验值相匹配。这一阶段的校准需要完整的工作循环仿真，包括压缩、燃烧和膨胀过程。

排气温度$T_{\text{exh}}$是燃烧放热和壁面散热共同作用的结果。在燃烧结束后的膨胀过程中，高温燃气向气缸壁面持续传热，导致温度逐渐下降。排气阀开启时刻的缸内温度近似代表排气温度。如果传热系数偏大，壁面散热增加，排气温度偏低；反之，传热系数偏小，排气温度偏高。

Woschni传热系数$C$是传热模型中的主要校准参数。从Woschni公式可知，换热系数$h$与$C$成正比，因此$C$的取值直接决定了传热强度的整体水平。除了主系数$C$外，其他速度系数（$C_1$、$C_2$）通常保持经典Woschni值不变，仅在必要时进行微调。

传热校准采用L-BFGS-B算法进行优化。目标函数定义为排气温度的相对误差平方：

$$f_3(C) = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{T_{\text{exh,sim}}^{(i)} - T_{\text{exh,exp}}^{(i)}}{T_{\text{exh,exp}}^{(i)} + 273.15} \right)^2$$

式中，排气温度采用绝对温度计算相对误差，以避免当$T_{\text{exh,exp}}$接近零时误差发散。Woschni系数的搜索范围设定为80至200，涵盖了不同发动机类型和运行条件下的典型取值。

校准过程中的一个技术细节是排气温度的估算方法。由于零维模型不直接模拟排气过程，排气温度需要根据膨胀终点状态进行估算。本模型采用的方法是取膨胀终点温度乘以经验修正系数（约0.85）作为排气温度的近似值。这一修正考虑了排气阀开启后的膨胀冷却效应。

传热校准完成后，三阶段校准流程即告结束。此时，模型的所有主要参数均已确定，可以输出完整的校准参数集。这些参数包括：有效压缩比、喷油正时、扩散燃烧持续角、扩散燃烧形状因子和Woschni传热系数。将这些参数导入发动机模型，即可用于性能预测、故障诊断和控制策略开发等后续应用。

### 3.6 多工况验证与误差分析

三阶段校准完成后，需要对校准结果进行系统性验证。验证的目的是评估校准模型在不同运行条件下的预测精度，以及识别可能存在的模型偏差和适用范围限制。

验证采用交叉验证策略：将可用的稳态工况数据分为校准集和验证集，校准集用于参数优化，验证集用于精度评估。这种划分可以避免过拟合，真实反映模型的泛化能力。验证集应包含校准集未涵盖的工况点，特别是负荷和转速的边界条件。

验证指标包括三个关键参数的预测误差：压缩压力$P_{\text{comp}}$、最大爆发压力$P_{\text{max}}$和排气温度$T_{\text{exh}}$。对于每个参数，计算相对误差和均方根误差（RMSE）：

$$e_{\text{rel}} = \frac{|x_{\text{sim}} - x_{\text{exp}}|}{x_{\text{exp}}} \times 100\%$$

$$\text{RMSE} = \sqrt{\frac{1}{N}\sum_{i=1}^{N}(x_{\text{sim}}^{(i)} - x_{\text{exp}}^{(i)})^2}$$

对于工程应用，通常要求$P_{\text{comp}}$的相对误差小于2%，$P_{\text{max}}$的相对误差小于3%，$T_{\text{exh}}$的绝对误差小于15 K。如果验证集上的误差超出这些阈值，可能需要重新审视模型假设、检查数据质量或考虑引入额外参数进行精细调整。

误差来源分析是验证过程的重要环节。零维模型的预测误差可能来源于多个方面：模型假设的简化（如忽略空间不均匀性、假设瞬时燃烧等）、子模型的经验相关性误差（如Wiebe函数和Woschni公式的适用性）、测量数据的不确定性以及参数校准过程中的局部最优问题。通过分析误差在不同工况下的分布规律，可以识别主要误差来源，并为模型改进提供方向。

_【图6插入位置：校准结果验证对比图，包括仿真值与实验值的散点对比和误差分布直方图，建议放置于../results/fig_calibration_validation.png】_

## 4. 模型实现与算法流程

### 4.1 软件架构设计

本零维船用柴油机模型采用面向对象的模块化架构设计，使用Python语言实现。整个软件系统由五个核心模块组成：几何运动学模块（geometry）、燃烧模块（combustion）、传热模块（heat_transfer）、热力学求解器（thermodynamics）和发动机集成类（engine_model）。此外，还有专门的校准模块（calibrator）和数据加载模块（data_loader）用于参数识别。

几何运动学模块封装了发动机的基本几何参数和运动学计算方法。核心类EngineGeometry包含气缸直径、行程、气缸数、压缩比、连杆比等属性，并提供活塞位置、瞬时容积、容积变化率和平均活塞速度等计算方法。该模块还定义了二冲程发动机特有的气门正时参数（排气阀关闭角、扫气口关闭角等），用于确定有效压缩起点。

燃烧模块实现了双Wiebe燃烧放热模型。核心类DoublieWiebeCombustion包含预混燃烧和扩散燃烧的全部参数，并提供累积燃烧分数、瞬时燃烧率和放热率的计算方法。燃烧参数支持动态更新，以便在校准过程中进行调整。

传热模块实现了Woschni传热关联式。核心类WoschniHeatTransfer封装了传热系数计算、表面积计算和传热率计算等功能。该模块支持区分压缩过程和燃烧/膨胀过程的不同速度系数，并可以通过更新参考状态来适应不同工况。

热力学求解器是模型的核心计算引擎。类ThermodynamicSolver集成了几何、燃烧和传热三个子模块，构建并求解描述缸内热力学过程的ODE系统。该求解器提供设置运行工况、求解完整循环、仅求解压缩过程等接口，并支持故障注入（泄漏、燃油衰减）功能。

发动机集成类MarineEngine0D是面向用户的最高层接口。它将上述所有模块组装为完整的发动机仿真器，并提供运行仿真、获取性能参数、设置校准参数等统一接口。用户无需关心内部模块的细节，只需通过集成类的方法即可完成仿真和分析任务。

### 4.2 核心算法实现

热力学ODE求解是整个仿真流程的核心。ODE系统的右端函数ode_system在每个积分步长执行以下计算序列：

第一步，从状态向量中提取当前温度和质量，并将曲轴转角从弧度转换为上止点后度数（ATDC）。这一转换是必要的，因为燃烧模块的Wiebe函数以ATDC度数为自变量。

第二步，调用几何模块计算当前曲轴转角下的瞬时容积、容积变化率和活塞位置。容积用于状态方程计算压力，容积变化率用于计算容积功，活塞位置用于计算表面积。

第三步，调用燃烧模块获取当前燃烧分数和放热率。燃烧分数用于插值工质物性参数，放热率则直接进入能量方程。需要注意的是，放热率需要从度数域（J/deg）转换为弧度域（J/rad），转换系数为$180/\pi$。

第四步，计算当前压力并调用传热模块计算换热系数和传热率。计算传热需要倒拖压力作为参考，这通过多变压缩公式估算。传热率同样需要从时间域转换为角度域，转换因子为曲轴角速度$\omega$。

第五步，根据燃烧分数插值计算当前工质的比热比和定容比热。高温修正在此步骤应用，以考虑温度对比热容的影响。

第六步，将燃烧放热、传热损失和容积功代入能量守恒方程，计算温度导数。如果启用了泄漏模型，还需计算质量导数。最终返回状态导数向量。

ODE积分采用scipy.integrate.odeint函数，该函数基于LSODA算法，能够自动检测方程的刚性并选择合适的积分方法。积分区间从压缩起点延伸到膨胀终点，输出点数通常设为720（对应每0.33度一个数据点）以保证足够的分辨率。

### 4.3 校准流程详细步骤

三阶段校准的完整流程如下：

准备阶段：创建发动机模型实例和校准数据加载器实例。数据加载器读取CSV格式的监测数据，进行预处理和稳态工况筛选，提取若干代表性校准点。每个校准点包含运行工况（转速、扫气压力、扫气温度、喷油量）和实验测量值（压缩压力、最大爆发压力、排气温度）。

第一阶段（压缩校准）：选取校准点中的一个代表性工况，以压缩比为优化变量，以压缩压力相对误差为目标函数，运行L-BFGS-B优化。优化过程中，每次评估目标函数需要调用run_compression_only方法进行纯压缩仿真（不含燃烧）。优化收敛后，将最优压缩比应用于模型，并验证误差是否满足阈值要求。

第二阶段（燃烧校准）：以喷油正时、扩散燃烧持续角和形状因子为优化变量，以多个校准点上最大爆发压力相对误差的平均值为目标函数，运行差分进化优化。每次评估目标函数需要在所有校准点上调用run_cycle方法进行完整循环仿真。优化收敛后，将最优燃烧参数应用于模型。

第三阶段（传热校准）：以Woschni系数为优化变量，以排气温度相对误差为目标函数，运行L-BFGS-B优化。优化过程与第二阶段类似，需要在校准点上进行完整循环仿真。优化收敛后，将最优传热系数应用于模型。

完成阶段：汇总所有校准结果，输出最终参数集。在验证集上评估模型精度，生成校准报告。如有需要，可将参数导出为JSON文件以便后续使用。

整个校准流程的计算时间取决于校准点数量和优化迭代次数。对于典型配置（5个校准点、压缩段100次迭代、燃烧段15代×25个种群、传热段50次迭代），在普通个人计算机上的总计算时间约为数分钟。

## 5. 校准结果分析与讨论

### 5.1 典型校准案例

以某6G50ME-C9.6型二冲程低速船用柴油机为例，展示三阶段校准的典型结果。该机型的主要技术参数为：气缸直径620 mm，活塞行程2658 mm，6缸布置，额定转速约80 rpm，标称压缩比约13至15。

校准数据来源于船舶运营期间的连续监测记录，经预处理后提取了5个具有代表性的稳态工况点，覆盖从50%到100%负荷的工作范围。各工况点的实验测量值如下：压缩压力115至130 bar，最大爆发压力130至155 bar，排气温度350至450°C。

第一阶段校准结果：经过约60次迭代，优化收敛至有效压缩比13.42。在代表工况点上，仿真压缩压力为122.8 bar，实验值为123.0 bar，相对误差仅为0.16%。这一结果表明压缩模型能够准确再现实际的压缩过程。

第二阶段校准结果：差分进化算法在15代迭代后收敛，得到最优燃烧参数为：喷油正时2.15° BTDC，扩散燃烧持续角52.3°，形状因子1.48。在5个校准点上，最大爆发压力的平均相对误差为2.1%，最大单点误差为3.5%。

第三阶段校准结果：Woschni系数优化至127.5，排气温度的平均相对误差为3.8%。需要指出的是，排气温度的预测精度受多种因素影响，包括排气过程模型的简化和壁面温度估计的不确定性，因此误差略大于压力参数是可以接受的。

### 5.2 参数敏感性分析

为深入理解各参数对模型输出的影响程度，进行了参数敏感性分析。敏感性定义为输出相对变化与参数相对变化之比：

$$S = \frac{\Delta Y / Y}{\Delta X / X}$$

分析结果表明：压缩压力对压缩比高度敏感，敏感性系数约为1.35，即压缩比变化1%将导致压缩压力变化约1.35%；最大爆发压力对喷油正时敏感，每提前1度，$P_{\text{max}}$约增加2至3 bar；排气温度对Woschni系数和燃烧持续角均有较强敏感性，传热系数增加10%约导致排气温度下降15至20 K。

这些敏感性分析结果验证了分步校准策略的合理性：每个阶段优化的参数确实主要影响该阶段的目标变量，参数之间的交叉影响相对较弱。

### 5.3 模型局限性与改进方向

尽管三阶段校准策略在工程实践中展现了良好的效果，模型和方法仍存在一些局限性值得讨论。

首先，零维模型的本质假设是忽略缸内气体的空间不均匀性。这意味着模型无法捕捉燃烧室内的局部温度分布、火焰传播过程和排放物生成等细节信息。对于需要分析NOx排放或颗粒物生成的应用场景，需要引入更复杂的多区模型或三维CFD仿真。

其次，Wiebe燃烧模型是经验性质的，其参数在不同工况下可能有所变化。本研究采用了固定的燃烧参数进行全工况仿真，这在稳态工况下是可接受的，但在剧烈瞬态过程中可能产生误差。一种改进思路是建立燃烧参数与工况之间的映射关系，实现参数的自适应调整。

第三，传热模型采用了统一的壁面温度假设，而实际中壁面温度随工况和位置变化。对于要求更高精度的应用，可以考虑引入壁面温度的热平衡计算或测量值修正。

第四，校准过程依赖于实验数据的准确性。传感器漂移、信号噪声和数据传输误差都可能影响校准结果。建立完善的数据质量检测和异常值剔除机制，对于提高校准可靠性至关重要。

未来的改进方向包括：引入机器学习方法实现参数的在线自适应更新、扩展模型以包含换气过程和增压系统、以及开发图形化用户界面以方便工程师使用。

## 6. 本章小结

本章详细介绍了针对二冲程船用柴油机的零维热力学建模理论和基于真实数据的分步解耦校准方法。主要研究内容和结论如下：

第一，建立了完整的零维热力学模型框架，包括发动机几何运动学模型、双Wiebe燃烧放热模型、Woschni缸内传热模型和热力学状态方程求解器。模型采用模块化设计，便于扩展和维护。

第二，提出了分步解耦的三阶段校准策略：第一阶段通过调整有效压缩比使压缩压力与实验值匹配；第二阶段通过调整燃烧模型参数使最大爆发压力与实验值匹配；第三阶段通过调整传热系数使排气温度与实验值匹配。这一策略将复杂的多参数优化问题分解为若干简单的低维优化问题，显著提高了校准效率和可靠性。

第三，基于实际船用柴油机的监测数据完成了模型校准和验证。结果表明，校准后的模型在压缩压力、最大爆发压力和排气温度三个关键参数上的预测误差分别控制在2%、3%和5%以内，满足工程应用的精度要求。

本章建立的零维模型和校准方法为后续的发动机故障诊断和协同控制研究奠定了基础。校准后的模型能够准确预测发动机在各种工况下的性能表现，为故障特征提取和控制策略优化提供可靠的仿真平台。

_【图7插入位置：三阶段校准流程图，建议放置于../results/fig_calibration_flowchart.png】_

_【图8插入位置：校准完成后模型预测与实验数据对比的综合图，包括压力、温度曲线对比，建议放置于../results/fig_model_validation.png】_
