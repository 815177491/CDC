# 第4章 零维船用柴油机模型建模与校准

零维热力学模型因计算效率高、物理意义明确，广泛应用于发动机性能预测和故障诊断。本章介绍针对二冲程低速船用柴油机的零维模型及其三阶段分步解耦校准方法。

## 4.1 零维柴油机热力学建模

### 4.1.1 模型总体框架

#### 零维模型的理论基础

零维热力学模型（Zero-Dimensional Thermodynamic Model）是发动机性能仿真领域最为成熟且广泛应用的建模方法之一。与三维计算流体动力学（CFD）模型和一维气体动力学模型相比，零维模型具有计算效率高（单个工作循环仿真时间在毫秒量级）、物理意义明确、参数可解释性强等显著优势，特别适用于需要大量循环仿真的应用场景，如实时故障诊断、控制策略优化、参数敏感性分析和虚拟传感器开发等。

零维模型的核心思想是将气缸视为一个时变的热力学控制体（Control Volume），采用"集总参数"（Lumped Parameter）方法，假设在任意时刻缸内工质的压力、温度和组分浓度均匀分布，不考虑空间梯度的影响。这一简化假设在大多数工况下是合理的。在压缩和膨胀过程中，活塞运动速度远低于声速，压力波在气缸内传播的时间尺度（微秒量级）远小于活塞运动的时间尺度（毫秒量级），缸内压力可视为均匀分布。在燃烧过程中，虽然火焰面附近存在局部高温区，但柴油机的扩散燃烧具有多点着火和快速湍流混合的特点，使得温度场在宏观尺度上趋于均匀化。对于换热过程，零维模型通过引入经验传热关联式（如Woschni公式）来等效处理复杂的缸内对流和辐射换热，避免了求解详细的温度场分布

#### 模型架构与模块划分

本研究建立的零维模型采用模块化设计思想，由四个功能相对独立的子模块构成，各模块之间通过明确定义的接口进行数据交换：

![图4-1 零维模型框架](../visualization_output/modeling/model_framework.svg)

**图4-1 零维模型框架**：四个子模块的层次化架构及数据流动关系。几何模块输出$V(\theta)$、$dV/d\theta$；燃烧模块输出$dQ_{comb}/d\theta$；传热模块输出$dQ_{wall}/d\theta$；热力学求解器集成三者求解缸内状态。

各子模块的功能定位如下：

1. **几何运动学模块**：根据曲柄连杆机构的几何参数和曲轴转角$\theta$，计算气缸瞬时容积$V(\theta)$及其变化率$dV/d\theta$。该模块是纯运动学计算，不涉及热力学状态，输出结果供其他三个模块使用。

2. **燃烧放热模块**：采用双Wiebe函数描述柴油机燃烧的累积放热规律，计算瞬时燃烧放热率$dQ_{\text{comb}}/d\theta$。燃烧模块接收来自热力学求解器的缸内状态（温度、压力）用于判断燃烧进程。

3. **缸内传热模块**：采用Woschni经验公式计算缸内气体与壁面之间的对流换热，输出瞬时传热损失率$dQ_{\text{wall}}/d\theta$。传热模块需要几何模块提供的换热面积和热力学模块提供的缸内状态。

4. **热力学求解器**：作为核心集成模块，基于热力学第一定律建立能量守恒微分方程，调用上述三个模块的输出，采用数值积分方法求解缸内温度$T(\theta)$和压力$p(\theta)$的演化过程。

#### 控制方程

模型核心是基于热力学第一定律的能量守恒方程。对于闭口系统（忽略质量交换的简化模型），能量守恒可表示为：

$$dU = \delta Q - \delta W$$

其中$dU$为内能变化，$\delta Q$为热量交换，$\delta W$为对外做功。将上式展开并以曲轴转角$\theta$为自变量，可得温度的一阶常微分方程：

$$\frac{dT}{d\theta} = \frac{1}{mc_v} \left[ \frac{dQ_{\text{comb}}}{d\theta} - \frac{dQ_{\text{wall}}}{d\theta} - p \frac{dV}{d\theta} \right]$$

式中$mc_v$为工质热容量（$m$为缸内工质质量，$c_v$为定容比热），$dQ_{\text{comb}}/d\theta$为燃烧放热率，$dQ_{\text{wall}}/d\theta$为壁面传热率，$p \cdot dV/d\theta$为容积功率。

压力通过理想气体状态方程计算：

$$p = \frac{mRT}{V}$$

其中$R = 287.0$ J/(kg·K)为空气的气体常数。对于燃烧产物，气体常数略有变化，但在工程计算中通常忽略这一影响。

### 4.1.2 发动机几何运动学模型

#### 曲柄连杆机构运动学分析

曲柄连杆机构是往复式内燃机的核心运动转换机构，其功能是将活塞的往复直线运动转换为曲轴的旋转运动。准确的运动学分析是零维模型的基础，直接影响容积变化率、活塞速度等关键参数的计算精度。

活塞位移$x$（以上止点为零点，向下为正）采用精确运动学公式计算：

$$x = R \left[ (1 - \cos\theta) + \frac{1}{\lambda} \left( 1 - \sqrt{1 - \lambda^2 \sin^2\theta} \right) \right]$$

式中：

- $R$：曲柄半径，等于活塞行程的一半，即$R = S/2$
- $L$：连杆长度，从连杆大端中心到小端中心的距离
- $\theta$：曲轴转角，以上止点（TDC）为零点，顺时针方向为正
- $\lambda = R/L$：曲柄连杆比，是影响活塞运动特性的关键无量纲参数

上式右边第一项$(1-\cos\theta)$是假设连杆无限长时的简谐运动分量；第二项是由于连杆有限长度引起的修正项，使活塞运动偏离简谐运动。

![图4-2 曲柄连杆机构几何](../visualization_output/modeling/crank_geometry_schematic.svg)

**图4-2 曲柄连杆机构几何示意图**：展示不同曲轴转角下的活塞位置、连杆姿态及关键几何参数标注。

#### 连杆比$\lambda$对活塞运动的影响

曲柄连杆比$\lambda = R/L$是曲柄连杆机构最重要的设计参数之一，其取值对活塞运动特性有显著影响。当$\lambda > 0$时，活塞在上半行程（从TDC到BDC）和下半行程（从BDC到TDC）的运动不再对称：活塞从上止点下行时初期速度增长较快，而从下止点上行时初期速度增长较慢，$\lambda$越大这种不对称性越明显。理想简谐运动的最大速度出现在$\theta = 90°$，但由于连杆有限长度的影响，实际最大速度位置向上止点方向偏移，偏移角度约为$\arcsin(\lambda/2)$。$\lambda$的存在还引入了活塞运动的二阶谐波分量，产生频率为曲轴转频两倍的二阶惯性力，这是发动机振动的重要来源之一。

对于大型低速船用柴油机，连杆比$\lambda$的典型取值范围为0.2至0.3。本模型采用的发动机连杆长度比$L/R = 4.0$，对应$\lambda = 0.25$，属于中等偏小的取值，可以在机构紧凑性和运动平稳性之间取得良好平衡。

#### 气缸容积计算

瞬时气缸容积由余隙容积$V_c$和活塞扫过的容积两部分组成：

$$V(\theta) = V_c + A_p \cdot x(\theta)$$

其中活塞面积$A_p = \pi D^2 / 4$，$D$为气缸直径。

余隙容积$V_c$是活塞位于上止点时气缸内的残余容积，由几何压缩比$\varepsilon$和气缸工作容积$V_s$确定：

$$V_c = \frac{V_s}{\varepsilon - 1}$$

气缸工作容积（排量）为：

$$V_s = A_p \cdot S = \frac{\pi D^2}{4} \cdot S$$

对于本模型的船用柴油机，$D = 0.620$ m，$S = 2.658$ m，单缸工作容积$V_s \approx 0.802$ m³。

#### 容积变化率推导

容积变化率$dV/d\theta$是计算容积功的关键参数。对活塞位移公式求导可得：

$$\frac{dV}{d\theta} = A_p \cdot \frac{dx}{d\theta} = A_p \cdot R \left[ \sin\theta + \frac{\lambda \sin\theta \cos\theta}{\sqrt{1 - \lambda^2 \sin^2\theta}} \right]$$

上式可以进一步整理为：

$$\frac{dV}{d\theta} = A_p \cdot R \cdot \sin\theta \left[ 1 + \frac{\lambda \cos\theta}{\sqrt{1 - \lambda^2 \sin^2\theta}} \right]$$

在上止点（$\theta = 0°$）和下止点（$\theta = 180°$），$\sin\theta = 0$，因此$dV/d\theta = 0$，这与活塞在死点位置速度为零的物理事实一致。容积变化率的最大值出现在$\theta \approx 90°$附近，此时气缸容积变化最快，做功能力最强。

![图4-3 曲柄连杆运动学特性](../visualization_output/modeling/crank_kinematics.svg)

**图4-3 曲柄连杆运动学特性**：(a)活塞位移曲线；(b)活塞速度曲线；(c)气缸容积曲线；(d)容积变化率。

#### 平均活塞速度

平均活塞速度$C_m$是评价发动机热负荷和机械负荷的重要指标。对于二冲程发动机，每转一圈完成一个工作循环，平均活塞速度定义为：

$$C_m = 2Sn$$

式中$S$为活塞行程（单位：m），$n$为发动机转速（单位：r/s）。注意二冲程发动机的$C_m$计算公式与四冲程相同，但由于二冲程每转做功一次，其单位时间内的活塞往复次数是四冲程的两倍。

平均活塞速度是发动机设计的重要约束条件：

- 过高的$C_m$会导致活塞环和缸套的磨损加剧
- $C_m$还影响气流进出气缸的时间，对换气过程有重要影响
- 大型低速船用柴油机的$C_m$通常在6至8 m/s范围内

本模型发动机在额定转速102 RPM时，$C_m = 2 \times 2.658 \times (102/60) = 9.04$ m/s，属于中等偏高水平，反映了现代船用柴油机追求高功率密度的设计趋势。

**表4-1 发动机几何参数**

| 参数         | 符号           | 数值  | 单位  | 说明                                     |
| ------------ | -------------- | ----- | ----- | ---------------------------------------- |
| 气缸直径     | $D$            | 0.620 | m     | 大缸径设计，有利于提高功率密度           |
| 活塞行程     | $S$            | 2.658 | m     | 长行程设计，行程缸径比$S/D \approx 4.3$  |
| 气缸数量     | $n_{cyl}$      | 6     | -     | 典型的中小型船用主机配置                 |
| 连杆长度比   | $L/R$          | 4.0   | -     | 对应$\lambda = 0.25$，平衡紧凑性与平稳性 |
| 排气阀关闭角 | $\theta_{evc}$ | 230   | °ATDC | 在下止点后50°关闭                        |
| 扫气口关闭角 | $\theta_{spc}$ | 235   | °ATDC | 比排气阀晚5°关闭                         |

表中的行程缸径比$S/D \approx 4.3$是大型低速船用柴油机的典型特征。与车用柴油机（$S/D \approx 1.0 \sim 1.2$）相比，长行程设计具有以下优势：

- 提高燃烧效率：较高的压缩比和较充分的膨胀做功
- 降低转速：在给定$C_m$限制下，转速与行程成反比关系
- 便于增压：充足的时间进行换气和扫气
- 燃料适应性强：较长的燃烧时间有利于使用重质燃料油

#### 二冲程配气正时

二冲程柴油机的换气过程与四冲程有本质区别。四冲程发动机采用活塞主动排气和进气，而二冲程发动机则依赖扫气箱的增压气体进行强制换气。根据扫气方式的不同，二冲程发动机可分为弪流扫气、直流扫气和回流扫气三类。本模型采用大型低速柴油机常用的直流扫气（Uniflow Scavenging）方式，其特点是：

1. **排气阀在气缸顶部**：由凸轮机构驱动开启和关闭，可精确控制排气正时
2. **扫气口在气缸下部**：由活塞位置控制开启和关闭，关闭时刻取决于扫气口几何高度
3. **扫气气流方向单一**：从下向上流动，排气效率高，新鲜空气与残余废气混合少

配气正时的关键时间节点如下：

- **排气阀开启（EVO）**：在下止点前数十度，利用缸内高压实现自由排气
- **扫气口开启（SPO）**：在排气阀开启后稍晚，等缸压降至扫气压力附近
- **下止点（BDC）**：位于换气过程中间，扫气和排气同时进行
- **排气阀关闭（EVC）**：$\theta_{evc} = 230°$ ATDC，排气阀先关闭，止气流由扫气口反向流出
- **扫气口关闭（SPC）**：$\theta_{spc} = 235°$ ATDC，扫气口后关闭，確保缸内充满新鲜空气

有效压缩过程的起点由排气阀关闭角和扫气口关闭角中的较大者决定：

$$\theta_{\text{comp,start}} = \max(\theta_{evc}, \theta_{spc}) = \max(230°, 235°) = 235° \text{ ATDC}$$

这意味着在扫气口关闭后，气缸才真正开始压缩过程。有效压缩行程为$360° - 235° = 125°$，对应的有效压缩比小于几何压缩比，这是二冲程发动机的重要特点。

![图4-4 二冲程配气正时图](../visualization_output/modeling/valve_timing_diagram.svg)

**图4-4 二冲程配气正时圆形图**：展示排气阀/扫气口开闭时序，以及压缩、燃烧膨胀、换气三个阶段的角度范围。圆形图直观地展示了各工作阶段的角度分配，扫气口开启期间与排气阀开启期间的重叠区域是扫气换气过程发生的时段。

### 4.1.3 双Wiebe燃烧放热模型

#### 柴油机燃烧的物理机理

柴油机采用压燃点火方式，其燃烧过程与点燃式发动机有本质区别。在柴油机中，燃料在压缩行程末期的高温高压环境下通过喷油器以高速射流的形式喷入气缸，经历雾化、蒸发、与空气混合、化学反应准备等一系列物理化学过程后自行着火。

柴油机的燃烧过程通常分为四个阶段。**着火延迟期**是从燃料开始喷射到着火开始的时间间隔，在此期间燃料完成物理准备（雾化、蒸发、混合）和化学准备（低温氧化反应、活性基积累），其长短取决于缸内温度、压力、燃料十六烷值和混合气组分等因素。着火发生后进入**预混燃烧期**，延迟期内已形成的可燃混合气迅速燃烧，由于这部分混合气已经充分混合，燃烧速率主要受化学动力学控制，放热迅速而集中，表现为尖锐的放热峰，其强度取决于延迟期内积累的可燃混合气量。预混燃烧结束后进入**扩散燃烧期**，这是主要的燃烧阶段，此时燃料边喷射边燃烧，燃烧速率主要受燃料与空气混合速率的控制，放热曲线较为平缓，持续时间较长。最后是**后燃期**，在膨胀行程中继续进行缓慢燃烧，这部分热量对做功的贡献较小，但会提高排气温度。

对于大型低速船用柴油机，由于转速低（通常50至150 RPM）而缸径大（超过0.5 m），其燃烧特点与高速柴油机有显著不同：

- **着火延迟短**：缸内温度高、反应时间充足，着火延迟通常只有2至5°曲轴转角
- **预混燃烧占比小**：着火延迟短使得积累的预混混合气量少，预混燃烧占怆1°至20%
- **扩散燃烧主导**：80%以上的燃料通过扩散燃烧方式释放热量
- **喷油持续期长**：可达40至60°曲轴转角，远超过高速柴油机

#### Wiebe函数的数学形式

Wiebe函数是描述内燃机燃烧放热规律最广泛使用的经验公式，由苏联学者Wiebe在1956年提出。单Wiebe函数描述累积燃烧分数（Mass Fraction Burned）与曲轴转角的关系：

$$x_b(\theta) = 1 - \exp\left[ -a \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^{m+1} \right]$$

式中$a = 6.908$（对应99.9%燃烧完成），$m$为形状因子，$\Delta\theta$为燃烧持续角。

双Wiebe模型将总燃烧分数表示为两阶段的加权叠加：

$$x_b^{\text{total}} = \beta \cdot x_b^{\text{premix}} + (1 - \beta) \cdot x_b^{\text{diffusion}}$$

对于大型船用柴油机，预混燃烧占比$\beta \approx 0.15$。瞬时燃烧率通过求导获得，燃烧放热率为$dQ_{\text{comb}}/d\theta = m_f \cdot H_u \cdot \eta_c \cdot dx_b/d\theta$。

![图4-5 双Wiebe燃烧模型](../visualization_output/modeling/dual_wiebe_combustion.svg)

**图4-5 双Wiebe燃烧模型特性**：(a)预混+扩散燃烧叠加的累积燃烧曲线；(b)瞬时燃烧率分解；(c)形状因子$m$对燃烧曲线的影响；(d)不同$m$值的燃烧率峰值对比。

**表4-2 双Wiebe燃烧模型参数**

| 参数         | 符号                  | 默认值 | 单位  | 说明             |
| ------------ | --------------------- | ------ | ----- | ---------------- |
| 预混燃烧占比 | $\beta$               | 0.15   | -     | 船机预混占比较低 |
| 预混持续角   | $\Delta\theta_p$      | 8.0    | °     | 快速燃烧         |
| 扩散持续角   | $\Delta\theta_d$      | 55.0   | °     | **待校准**       |
| 扩散形状因子 | $m_d$                 | 1.5    | -     | **待校准**       |
| 喷油正时     | $\theta_{\text{inj}}$ | 2.0    | °BTDC | **待校准**       |
| 燃油低热值   | $H_u$                 | 42.7   | MJ/kg | 重质船用燃料油   |

**效率因子$a$的确定**：效率因子$a$的取值与燃烧完成度的定义有关。设归一化时间$\tau = (\theta - \theta_{\text{ign}})/\Delta\theta$，当$\tau = 1$（即燃烧持续角结束时刻）时，累积燃烧分数为：

$$x_b(\tau=1) = 1 - e^{-a}$$

若要求99.9%的燃烧完成度，即$x_b = 0.999$，则需要$e^{-a} = 0.001$，解得：

$$a = -\ln(0.001) = 6.908$$

本研究采用$a = 6.908$，这是工程应用中最常用的取值，对应99.9%的燃烧完成度。

**形状因子$m$对燃烧曲线的影响**：形状因子$m$对燃烧放热曲线的形态有显著影响：

- 当$m$较小（如$m < 1$）时，燃烧放热集中于燃烧初期，放热率曲线呈现"快起慢落"的特点，峰值出现较早，适合描述快速燃烧过程
- 当$m$较大（如$m > 2$）时，燃烧放热较为平缓，放热率曲线呈现"慢起快落"的特点，峰值出现较晚，适合描述缓慢燃烧过程
- 典型的柴油机预混燃烧$m_p$在2至4之间，扩散燃烧$m_d$在0.5至2.0之间

**双Wiebe函数模型**

对于大型船用柴油机，由于其燃烧室尺寸大（缸径超过0.5m）、喷油持续期长（可达40至60个曲轴转角度），预混燃烧和扩散燃烧具有明显不同的放热特征，用单一Wiebe函数难以准确描述整个燃烧过程。因此，本模型采用**双Wiebe函数**分别描述预混燃烧和扩散燃烧两个阶段。

双Wiebe模型将总累积燃烧分数表示为预混燃烧和扩散燃烧的加权叠加：

$$x_b^{\text{total}}(\theta) = \beta \cdot x_b^{\text{premix}}(\theta) + (1 - \beta) \cdot x_b^{\text{diffusion}}(\theta)$$

式中，$\beta$为预混燃烧质量分数，表示参与预混燃烧的燃油占总喷油量的比例。对于大型低速船用柴油机，由于着火延迟期短、喷油持续期长，$\beta$通常在0.10至0.20之间，即仅有10%至20%的燃油参与预混燃烧，本模型取$\beta = 0.15$。

预混燃烧和扩散燃烧分别采用独立的Wiebe参数：

- **预混燃烧**：持续角$\Delta\theta_p$较短（约8°），形状因子$m_p$较大（约3.0），产生尖锐而短促的放热峰
- **扩散燃烧**：持续角$\Delta\theta_d$较长（30°至70°），形状因子$m_d$较小（0.5至2.0），产生平缓而持久的放热曲线

两阶段燃烧通常假设同时从着火角$\theta_{\text{ign}}$开始，但由于持续角和形状因子不同，其放热曲线形态完全不同。双Wiebe模型的这种结构能够很好地反映船用柴油机"快慢结合"的燃烧特点。

**瞬时燃烧率计算**

瞬时燃烧率（单位曲轴转角度内燃烧的燃油质量分数）通过对累积燃烧分数求导获得：

$$\frac{dx_b}{d\theta} = \frac{a(m+1)}{\Delta\theta} \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^m \exp\left[ -a \left( \frac{\theta - \theta_{\text{ign}}}{\Delta\theta} \right)^{m+1} \right]$$

将预混燃烧和扩散燃烧的燃烧率加权叠加，即得到总瞬时燃烧率。

**燃烧放热率计算**

燃烧放热率与燃烧率的关系为：

$$\frac{dQ_{\text{comb}}}{d\theta} = m_f \cdot H_u \cdot \eta_c \cdot \frac{dx_b}{d\theta}$$

式中：

- $m_f$为循环喷油量（单位：kg/循环），由燃油指令和发动机转速决定
- $H_u$为燃油低热值（单位：J/kg），对于重质船用燃料油约为42.7 MJ/kg
- $\eta_c$为燃烧效率，表示实际放热量与理论放热量的比值，通常取0.95至0.99，本模型取0.98

**着火角的确定**

着火角$\theta_{\text{ign}}$由喷油正时和着火延迟共同决定。设喷油正时为$\theta_{\text{inj}}$（以上止点前度数BTDC表示，取正值），着火延迟为$\tau_{\text{id}}$（单位：曲轴转角度），则着火角为：

$$\theta_{\text{ign}} = -\theta_{\text{inj}} + \tau_{\text{id}}$$

例如，若喷油正时为8°BTDC（即$\theta_{\text{inj}} = 8$），着火延迟为2°，则着火角$\theta_{\text{ign}} = -8 + 2 = -6°$ATDC，即上止点前6度着火。

双Wiebe燃烧模型的默认参数如表4-2所示。

**表4-2 双Wiebe燃烧模型参数**

| 参数         | 符号                  | 默认值 | 单位  | 说明                         |
| ------------ | --------------------- | ------ | ----- | ---------------------------- |
| 预混燃烧占比 | $\beta$               | 0.15   | -     | 船机预混占比较低             |
| 预混持续角   | $\Delta\theta_p$      | 8.0    | °     | 快速燃烧阶段                 |
| 预混形状因子 | $m_p$                 | 3.0    | -     | 产生尖锐放热峰               |
| 扩散持续角   | $\Delta\theta_d$      | 55.0   | °     | **待校准**，控制燃烧速率     |
| 扩散形状因子 | $m_d$                 | 1.5    | -     | **待校准**，控制放热曲线形状 |
| 着火延迟     | $\tau_{\text{id}}$    | 2.0    | °     | 简化为常数                   |
| 喷油正时     | $\theta_{\text{inj}}$ | 2.0    | °BTDC | **待校准**，控制燃烧相位     |
| 燃油低热值   | $H_u$                 | 42.7   | MJ/kg | 重质船用燃料油               |
| 燃烧效率     | $\eta_c$              | 0.98   | -     | 高效燃烧                     |
| Wiebe常数    | $a$                   | 6.908  | -     | 对应99.9%燃烧完成            |

表中标注"待校准"的参数是后续校准过程的主要调整对象。喷油正时$\theta_{\text{inj}}$决定燃烧开始的时刻，直接影响最大压力的相位和大小；扩散持续角$\Delta\theta_d$和形状因子$m_d$共同决定扩散燃烧阶段的放热速率和持续时间，对最大爆发压力$P_{\text{max}}$有显著影响。

### 4.1.4 Woschni缸内传热模型

#### 缸内传热的物理过程

缸内气体与燃烧室壁面之间的传热是影响发动机性能和组件热负荷的重要因素。缸内传热主要包括对流换热、辐射换热和导热三种方式。其中对流换热是缸内高速气流与壁面之间的强制对流，是缸内传热的主要方式，通常占总传热量的90%以上。辐射换热由燃烧产生的高温火焰和烟粒子向壁面的热辐射引起，在燃烧阶段占比较大，但在零维模型中通常简化处理或并入对流换热系数。导热通过贴近壁面的层流边界层进行，由于边界层很薄，通常也合并在对流换热系数中考虑。零维模型采用经验关联式来计算缸内对流换热，其中Woschni公式是最经典且广泛使用的关联式之一，由德国学者Woschni在1967年提出，并经过多次改进和扩展。

#### Woschni传热公式

Woschni公式基于无量纲分析和大量实验数据拟合得到，其计算对流换热系数的表达式为：

$$h = C \cdot D^{-0.2} \cdot p^{0.8} \cdot T^{-0.53} \cdot w^{0.8}$$

式中各参数的物理意义如下：

- $h$：对流换热系数，单位为W/(m²·K)，反映缸内气体与壁面之间的换热强度
- $C$：Woschni主系数，无量纲常数，需要校准确定，典型取值范围为80至200
- $D$：气缸直径，单位为m。指数-0.2表明换热系数与缸径呈弱负相关，大缸径发动机的$h$略低
- $p$：缸内压力，单位为Pa。指数0.8表明换热系数与压力强正相关，高压工况下换热增强
- $T$：缸内气体温度，单位为K。指数-0.53表明换热系数与温度呈负相关，这反映了高温时气体粘度、导热系数等物性的变化
- $w$：特征气流速度，单位为m/s。指数0.8表明换热系数与气流速度强正相关，反映了湍流强度对传热的影响

上述指数的物理来源可以通过无量纲分析理解。Woschni公式本质上是Nusselt数$Nu$与Reynolds数$Re$的关联式$Nu = C_0 \cdot Re^{0.8}$的展开形式，指数0.8来源于湍流管流的Dittus-Boelter关联式。

#### 特征气流速度

特征气流速度$w$是Woschni公式的关键参数，它综合考虑了影响缸内气体运动的两个主要因素：

$$w = C_1 C_m + C_2 \frac{V_s T_r}{p_r V_r} (p - p_{\text{mot}})$$

第一项$C_1 C_m$表示由活塞往复运动引起的基础气流运动：

- $C_m$：平均活塞速度，$C_m = 2Sn$
- $C_1$：速度系数，在压缩和膨胀过程中取$C_1 = 2.28$。这一系数反映了气缸内平均气流速度与平均活塞速度之间的比例关系，表明缸内气体的平均运动速度约为平均活塞速度的2.28倍

第二项表示燃烧过程产生的附加湍流：

- $C_2$：燃烧附加系数，典型值为$3.24 \times 10^{-3}$
- $V_s$：气缸工作容积
- $T_r$, $p_r$, $V_r$：参考状态（通常取扫气口关闭时刻）的温度、压力和容积
- $p - p_{\text{mot}}$：实际压力与倒拖压力的差值，反映燃烧引起的压力升高

倒拖压力$p_{\text{mot}}$是假设不发生燃烧时的多变压缩/膨胀压力：

$$p_{\text{mot}} = p_0 \left( \frac{V_0}{V} \right)^n$$

式中$p_0$和$V_0$为压缩起点的压力和容积，$n$为多变指数，压缩过程取$n = 1.32$，膨胀过程取$n = 1.28$。

燃烧附加项的物理意义是：燃烧过程中的快速放热引起缸内气体迅速膨胀，产生较强的湍流运动，显著增强了对流换热。该项只在燃烧过程中起作用，当$p > p_{\text{mot}}$时为正，当$p < p_{\text{mot}}$时取零。

#### 换热面积计算

缸内换热面积$A_{\text{surf}}$由三部分组成：

$$A_{\text{surf}} = A_{\text{piston}} + A_{\text{head}} + A_{\text{liner}}$$

各部分的计算方法如下。活塞顶面积$A_{\text{piston}} = \frac{\pi D^2}{4}$，对于平顶活塞直接等于气缸截面积，若活塞顶有凹坑或挡流纹则需考虑有效面积修正。缸盖面积$A_{\text{head}} = \frac{\pi D^2}{4} \cdot k_h$，其中$k_h$为缸盖面积修正系数，考虑喷油器、气阀等凸出结构的影响，典型值为1.0至1.2。缸套侧面积$A_{\text{liner}} = \pi D \cdot x(\theta)$随活塞位置变化，当活塞在上止点时$x = 0$，缸套侧面暴露面积最小；当活塞在下止点时$x = S$，缸套侧面暴露面积最大。

因此，总换热面积为：

$$A_{\text{surf}}(\theta) = \frac{\pi D^2}{4}(1 + k_h) + \pi D \cdot x(\theta)$$

对于本模型的发动机，$D = 0.620$ m，$S = 2.658$ m，则：

- 活塞顶面积：$A_{\text{piston}} = 0.302$ m²
- 缸盖面积（$k_h = 1.0$）：$A_{\text{head}} = 0.302$ m²
- 缸套最大侧面积：$A_{\text{liner,max}} = \pi \times 0.620 \times 2.658 = 5.18$ m²
- 总换热面积范围：0.604 m²（TDC）至5.78 m²（BDC）

可见，缸套侧面积是换热面积的主要组成部分，这也是为什么缸套冷却在发动机热负荷管理中如此重要。

#### 壁面温度边界条件

缸内传热计算需要知道各壁面的温度边界条件。由于燃烧室各部位的冷却条件和热负荷不同，其平均温度也不同：

**表4-3a 壁面温度边界条件**

| 部位         | 符号                | 典型温度 | 单位 | 说明                         |
| ------------ | ------------------- | -------- | ---- | ---------------------------- |
| 缸套平均温度 | $T_{\text{wall}}$   | 450      | K    | 水套冷却，温度分布较均匀     |
| 活塞顶温度   | $T_{\text{piston}}$ | 550      | K    | 热负荷最高，且无直接冷却     |
| 缸盖温度     | $T_{\text{head}}$   | 500      | K    | 包括排气阀底面、喷油器附近等 |

在零维模型中，通常采用加权平均的方式计算等效壁面温度：

$$T_{\text{wall,eff}} = \frac{A_{\text{piston}} T_{\text{piston}} + A_{\text{head}} T_{\text{head}} + A_{\text{liner}} T_{\text{wall}}}{A_{\text{surf}}}$$

或者采用简化处理，统一使用单一的等效壁温。本模型采用$T_{\text{wall}} = 450$ K作为统一的壁面温度，这是大型船用柴油机水冷系统设计条件下的合理估计值。

#### 瞬时传热率计算

根据牛顿冷却定律，瞬时传热率为：

$$\dot{Q}_{\text{wall}} = h \cdot A_{\text{surf}} \cdot (T - T_{\text{wall}})$$

将时间基的传热率转换为曲轴转角基的传热率，需考虑曲轴角速度$\omega = 2\pi n$：

$$\frac{dQ_{\text{wall}}}{d\theta} = \frac{\dot{Q}_{\text{wall}}}{\omega} = \frac{h \cdot A_{\text{surf}} \cdot (T - T_{\text{wall}})}{2\pi n}$$

在燃烧阶段，缸内温度可达1800至2200 K，与壁温的温差超过1500 K，此时传热损失最大。在压缩和膨胀过程中，温差较小，传热损失相对较低。

![图4-6 Woschni传热特性](../visualization_output/modeling/woschni_heat_transfer.svg)

**图4-6 Woschni传热模型特性**：(a)特征气速随曲轴转角变化；(b)对流换热系数曲线；(c)缸内压力和温度变化；(d)Woschni系数C的敏感性分析。从TDC附近开始，燃烧引起的附加湍流使特征气速和换热系数显著增大。

**表4-3 Woschni传热模型参数**

| 参数          | 符号              | 默认值              | 单位 | 说明                         |
| ------------- | ----------------- | ------------------- | ---- | ---------------------------- |
| Woschni主系数 | $C$               | 130.0               | -    | **待校准**，影响整体传热强度 |
| 压缩速度系数  | $C_1$             | 2.28                | -    | 压缩/膨胀过程的基础气流系数  |
| 燃烧附加系数  | $C_2$             | $3.24\times10^{-3}$ | -    | 燃烧阶段的湍流增强系数       |
| 压缩多变指数  | $n_{\text{comp}}$ | 1.32                | -    | 压缩过程多变指数             |
| 膨胀多变指数  | $n_{\text{exp}}$  | 1.28                | -    | 膨胀过程多变指数             |
| 壁面温度      | $T_{\text{wall}}$ | 450                 | K    | 水冷缸套平均温度             |

### 4.1.5 热力学循环求解

#### ODE系统的构建

热力学求解器是零维模型的核心，负责求解描述缸内热力学状态演化的常微分方程组（ODE系统）。基本的ODE系统包含一个状态变量——缸内温度$T$，压力$p$通过状态方程代数计算。

从TDC到TDC的完整工作循环中，需要求解的能量守恒方程为：

$$\frac{dT}{d\theta} = \frac{1}{mc_v} \left[ \frac{dQ_{\text{comb}}}{d\theta} - \frac{dQ_{\text{wall}}}{d\theta} - p \frac{dV}{d\theta} \right]$$

该方程的物理解释是：缸内温度的变化率与三个能量交换项有关。当燃烧放热超过壁面散热和容积功时，温度上升；反之温度下降。

对于更精确的建模，可以将质量守恒方程也纳入ODE系统，考虑泄漏影响：

$$\frac{dm}{d\theta} = -\frac{dm_{\text{leak}}}{d\theta}$$

泄漏模型采用简化的压差驱动模型：

$$\frac{dm_{\text{leak}}}{d\theta} = K_{\text{leak}} \cdot (p - p_{\text{crank}})$$

式中$K_{\text{leak}}$为泄漏系数，$p_{\text{crank}}$为曲轴箱压力。泄漏主要发生在活塞环与缸套之间，故障条件下（如活塞环磨损、卡死）泄漏系数会显著增大。

当考虑泄漏时，压力计算需要使用更新后的质量：

$$p = \frac{mRT}{V}$$

#### 工质物性模型

缸内工质在工作循环中经历了组分变化（从空气到燃烧产物），其热物性参数也相应变化。零维模型通常采用基于燃烧分数$x_b$的线性插值方法计算工质物性。

**比热比$\gamma$的计算**：

$$\gamma = \gamma_{\text{air}} (1 - x_b) + \gamma_{\text{burned}} \cdot x_b$$

式中：

- $\gamma_{\text{air}} = 1.35$：空气的比热比，在压缩终点的高温条件下（约800 K），考虑了高温引起的$\gamma$下降
- $\gamma_{\text{burned}} = 1.28$：燃烧产物的比热比，由于CO₂、H₂O等多原子气体占比增加，$\gamma$值较低
- $x_b$：燃烧分数，范围[0, 1]，在燃烧前$x_b = 0$，燃烧完成后$x_b = 1$

**定容比热$c_v$的计算**：

$$c_v = \frac{R}{\gamma - 1}$$

考虑到高温时分子振动和离解对比热的影响，引入高温修正：

$$c_v = c_{v,\text{base}} \times \left[ 1 + k_T (T - T_0) \right], \quad \text{when } T > T_0$$

式中$k_T = 0.0001$ K⁻¹为高温修正系数，$T_0 = 1000$ K为修正起点温度。这一修正反映了在燃烧高温阶段，气体的热容量随温度升高而增大的物理现象。

**定压比热$c_p$的计算**：

$$c_p = c_v + R = \gamma \cdot c_v$$

或直接由比热比关系$c_p = \gamma R / (\gamma - 1)$计算。

#### 单位转换与注意事项

在ODE求解过程中，需要特别注意单位的一致性：

1. **角度单位转换**：很多公式中的角度以度（deg）为单位，但数学函数（sin, cos等）需要弧度（rad）为单位。转换关系为：
   $$\theta_{\text{rad}} = \theta_{\text{deg}} \times \frac{\pi}{180}$$

2. **燃烧率单位**：如果燃烧率$dx_b/d\theta$的$\theta$以度为单位，则燃烧放热率的单位为J/deg。在能量守恒方程中，各项的单位必须一致：
   - $dQ_{\text{comb}}/d\theta$：J/deg
   - $dQ_{\text{wall}}/d\theta$：J/deg
   - $p \cdot dV/d\theta$：Pa × m³/deg = J/deg

3. **传热率时间基转曲轴角基**：Woschni公式计算的传热率$\dot{Q}$单位为W（J/s），需要转换为J/deg：
   $$\frac{dQ_{\text{wall}}}{d\theta} = \frac{\dot{Q}}{\omega} \times \frac{180}{\pi} = \frac{\dot{Q}}{2\pi n} \times \frac{180}{\pi}$$
   式中$n$为转速，单位为r/s（需从RPM转换）。

#### 数值积分方法

ODE系统采用scipy库的`odeint`函数进行数值积分，该函数内部使用LSODA（Livermore Solver for Ordinary Differential equations with Automatic method switching）算法。

选择LSODA算法基于以下考虑。该算法能够自动检测方程的刚性（Stiffness），并在非刚性方法（Adams-Moulton）和刚性方法（BDF）之间自动切换，燃烧过程中的快速放热可能使方程呈现刚性特征，需要隐式方法来保证稳定性。算法还能根据局部截断误差估计自动调整积分步长，在缸内状态变化剧烈的阶段（如燃烧初期）采用小步长，在变化平缓的阶段（如压缩后期）采用大步长，兼顾了精度和效率。LSODA采用高阶多步法，在相同计算量下可获得比简单Euler法或Runge-Kutta法更高的精度。

积分配置参数：

- 积分区间：从扫气口关闭角（235° ATDC）到下一循环的相同位置（595° ATDC），即完整的360°
- 角度分辨率：通常取每度0.5°至1°，即721至1441个计算点
- 相对误差容限：rtol = 1e-6
- 绝对误差容限：atol = 1e-8

#### 初始条件设定

数值积分的初始条件在扫气口关闭时刻设定，此时气缸内充满扫气空气：

- **初始温度**：$T_0 = T_{\text{scav}}$，即扫气空气温度，典型值310至330 K
- **初始压力**：$p_0 = p_{\text{scav}}$，即扫气压力，通常为大气压力的90%至120%，取决于增压器工作点
- **初始质量**：由理想气体状态方程计算，$m_0 = p_0 V_0 / (R T_0)$，其中$V_0$为扫气口关闭时的气缸容积

这些初始条件假设扫气过程已经完成，残余废气已被完全排出。实际上，扫气效率不可能达到100%，残余废气的影响可以通过调整初始温度和工质组分来等效考虑。

![图4-7 热力学循环特性](../visualization_output/modeling/thermodynamic_cycle.svg)

**图4-7 热力学循环特性**：(a)P-V示功图，颜色表示燃烧分数，封闭曲线的面积代表循环指示功；(b)对数P-V图用于分析多变指数，压缩和膨胀过程应近似为直线；(c)T-P相图，标注压缩、燃烧、膨胀各阶段；(d)P-θ和T-θ曲线，展示压力和温度随曲轴转角的变化规律。

#### 模型输出与关键性能指标

ODE求解完成后，可以提取以下关键性能指标：

**$P_{\text{comp}}$（压缩终点压力）**是指在上止点（TDC）附近、燃烧开始之前的缸内压力，反映了压缩过程的效果。该参数主要取决于有效压缩比（由几何压缩比和配气正时共同决定）、扫气压力（压缩起点压力直接影响压缩终点压力）以及泄漏情况（活塞环密封不良会导致$P_{\text{comp}}$下降）。$P_{\text{comp}}$是故障诊断的重要指标，其异常下降通常指示泄漏类故障（活塞环磨损、气阀密封不良等）。

**$P_{\text{max}}$（最大爆发压力）**是燃烧过程中缸内达到的最高压力，通常出现在上止点后5°至20°，是评价燃烧系统工作状态的关键指标。该参数受喷油正时、燃烧放热率和负荷水平的综合影响：提前喷油会升高$P_{\text{max}}$，延迟喷油会降低$P_{\text{max}}$；快速燃烧产生较高的$P_{\text{max}}$；高负荷时$P_{\text{max}}$较高。$P_{\text{max}}$异常升高可能指示喷油正时过早或燃烧异常；异常降低可能指示喷油正时过晚、燃料品质问题或喷油器故障。

**$T_{\text{exh}}$（排气温度）**是膨胀行程结束时（排气阀开启前）的缸内温度，反映了燃烧放热和壁面散热之间的平衡。该参数受Woschni系数（传热系数越大，壁面散热越多，$T_{\text{exh}}$越低）、燃烧效率（燃烧不完全会导致后燃，升高$T_{\text{exh}}$）和空燃比（贫油燃烧$T_{\text{exh}}$较低，混合气过浓$T_{\text{exh}}$较高）等因素影响。$T_{\text{exh}}$异常升高是故障的重要预警信号，可能指示燃烧异常、泄漏或增压器故障。

**4. 平均指示压力$P_{\text{i}}$（IMEP）**

平均指示压力是评价发动机做功能力的核心指标，定义为循环指示功与气缸工作容积之比：

$$P_{\text{i}} = \frac{W_{\text{i}}}{V_s} = \frac{\oint p \, dV}{V_s}$$

数值计算时，采用Simpson积分法：

$$W_{\text{i}} = \int_{\theta_1}^{\theta_2} p(\theta) \frac{dV}{d\theta} d\theta \approx \frac{\Delta\theta}{3} \sum_{k=0}^{n/2} \left[ p_{2k} \left(\frac{dV}{d\theta}\right)_{2k} + 4p_{2k+1} \left(\frac{dV}{d\theta}\right)_{2k+1} + p_{2k+2} \left(\frac{dV}{d\theta}\right)_{2k+2} \right]$$

$P_{\text{i}}$与发动机指示功率的关系为：

$$P_{\text{ind}} = P_{\text{i}} \cdot V_s \cdot n \cdot z$$

式中$n$为转速（r/s），$z$为气缸数。对于二冲程发动机，每转做功一次，因此不需要除以2。

**表4-4 模型输出参数汇总**

| 参数         | 符号              | 典型范围 | 单位 | 物理意义                  |
| ------------ | ----------------- | -------- | ---- | ------------------------- |
| 压缩终点压力 | $P_{\text{comp}}$ | 80-120   | bar  | 压缩过程效果，泄漏指示    |
| 最大爆发压力 | $P_{\text{max}}$  | 120-180  | bar  | 燃烧过程指标，TDC后5°-20° |
| 排气温度     | $T_{\text{exh}}$  | 550-750  | K    | 能量平衡，故障预警        |
| 平均指示压力 | $P_{\text{i}}$    | 15-22    | bar  | 做功能力指标              |

---

## 4.2 校准数据获取与预处理

### 4.2.1 数据来源

模型校准需要高质量的实验数据作为参考基准。本研究的校准数据来源于船用柴油机运行监测系统，该系统实时采集发动机各类运行参数并存储于船舶数据记录系统中。采集的参数包括：

**表4-5 校准数据参数清单**

| 参数         | 符号              | 采集频率 | 典型范围 | 单位  | 用途             |
| ------------ | ----------------- | -------- | -------- | ----- | ---------------- |
| 发动机转速   | RPM               | 1 Hz     | 50-120   | r/min | 工况判定         |
| 燃油指令     | Fuel              | 1 Hz     | 20-100   | %     | 负荷指示         |
| 扫气压力     | $p_{\text{scav}}$ | 1 Hz     | 80-150   | kPa   | 初始条件         |
| 扫气温度     | $T_{\text{scav}}$ | 1 Hz     | 300-350  | K     | 初始条件         |
| 压缩压力     | $P_{\text{comp}}$ | 每循环   | 80-120   | bar   | 第一阶段校准目标 |
| 最大爆发压力 | $P_{\text{max}}$  | 每循环   | 120-180  | bar   | 第二阶段校准目标 |
| 排气温度     | $T_{\text{exh}}$  | 1 Hz     | 550-750  | K     | 第三阶段校准目标 |

压缩压力$P_{\text{comp}}$和最大爆发压力$P_{\text{max}}$通过安装在气缸盖上的压力传感器采集，每个工作循环记录一次峰值。排气温度$T_{\text{exh}}$通过安装在排气歧管入口处的热电偶测量。

数据采集的时间范围通常覆盖多个航次，以获取不同负荷工况下的数据。原始数据量通常较大（数万至数十万条记录），需要经过系统的预处理才能用于模型校准。

### 4.2.2 数据预处理流程

数据预处理的目标是从原始数据中提取高质量、具有代表性的校准点。预处理流程包括四个主要步骤：

#### （1）物理边界过滤

物理边界过滤是数据清洗的第一步，基于发动机的物理运行特性设定合理的参数范围，剔除明显不合理的数据点：

$$\text{Valid} = \begin{cases} \text{True} & \text{if } 30 < \text{RPM} < 120 \text{ and } 50 < P_{\text{max}} < 250 \\ \text{False} & \text{otherwise} \end{cases}$$

这些阈值的设定依据如下：

- 转速下限30 RPM：低于此值发动机处于极低负荷或停机状态，数据不具有校准意义
- 转速上限120 RPM：超过此值可能为传感器故障或记录错误
- 压力下限50 bar：低于此值很可能是倒拖工况或传感器故障
- 压力上限250 bar：超过此值可能为传感器故障或过载异常

同样的逻辑应用于其他参数，如扫气压力$p_{\text{scav}} \in [80, 200]$ kPa，扫气温度$T_{\text{scav}} \in [280, 380]$ K等。

#### （2）IQR异常值检测

基于四分位距（Interquartile Range, IQR）的异常值检测是一种稳健的统计方法，不易受极端值影响。对于每个参数，计算其第一四分位数$Q_1$（百分位数25%）和第三四分位数$Q_3$（百分位数75%），则IQR = $Q_3 - Q_1$。

异常值判定规则为：

$$\text{Outlier} = \begin{cases} \text{True} & \text{if } x < Q_1 - 1.5 \times \text{IQR} \text{ or } x > Q_3 + 1.5 \times \text{IQR} \\ \text{False} & \text{otherwise} \end{cases}$$

系数‘1.5’是统计学中常用的阈值，对于正态分布数据，该范围大约覆盖99.3%的数据。使用较小的系数（如1.0）会剔除更多数据，使用较大的系数（如2.0）则更宽松。

IQR方法的优势在于不假设数据符合特定分布，对极端值具有稳健性（四分位数不受极端值影响），且计算简单易于实现。

#### （3）稳态工况筛选

模型校准应基于稳态工况数据进行，避免过渡过程引入的动态误差。稳态工况的判定采用基于滑动窗口的统计方法：对转速RPM序列计算滑动窗口标准差（窗口宽度$W = 60$s），如果窗口内$\sigma_{\text{RPM}} < 1.0$ rpm则该时段判定为稳态，只保留稳态时段内的数据点。

数学表达式为：

$$\sigma_{\text{RPM}}(t) = \sqrt{\frac{1}{W} \sum_{\tau=t-W/2}^{t+W/2} \left( \text{RPM}(\tau) - \overline{\text{RPM}} \right)^2}$$

稳态判定条件：

$$\text{Steady State} = \begin{cases} \text{True} & \text{if } \sigma_{\text{RPM}} < 1.0 \text{ rpm} \\ \text{False} & \text{otherwise} \end{cases}$$

阈值1.0 rpm的设定基于工程经验，该值约为典型工作转速的1%，可有效剔除加速、减速和工况切换过程中的数据。

#### （4）代表性工况提取

经过上述筛选后的数据仍然可能较多，需要进一步提取具有代表性的工况点。采用分层抽样（Stratified Sampling）策略：按RPM范围将数据分为若干层，例如[50,60), [60,70), ..., [110,120) RPM；对每层内的数据点计算综合质量得分，基于工况稳定性和数据完整性；每层选取得分最高的$k$个数据点作为代表点。

综合质量得分的计算：

$$\text{Score} = -\left( w_1 \cdot \sigma_{P_{\text{comp}}} + w_2 \cdot \sigma_{P_{\text{max}}} + w_3 \cdot \sigma_{T_{\text{exh}}} \right)$$

其中$\sigma$表示该时段内的标准差，$w_i$为权重系数。得分越高（标准差越小），表示工况越稳定，数据质量越高。

![图4-8 数据预处理流程](../visualization_output/preprocessing/data_cleaning.svg)

**图4-8 数据清洗与异常值剔除**：展示了物理边界过滤和IQR异常值检测的效果。红色点为被剔除的异常数据，蓝色点为保留的有效数据。

![图4-9 稳态工况筛选](../visualization_output/preprocessing/steady_state_selection.svg)

**图4-9 稳态工况智能筛选**：上图为转速时间序列，下图为滑动窗口标准差。绿色区域表示识别出的稳态时段，橙色区域表示过渡过程被剔除。

![图4-10 代表性工况点](../visualization_output/preprocessing/representative_points.svg)

**图4-10 代表性工况点提取**：展示了分层抽样的结果。不同颜色表示不同RPM层的数据，星号标记为选取的代表点。

### 4.2.3 参数关联分析

在数据预处理完成后，进行参数关联分析有助于理解各变量之间的物理关系，为分步校准策略提供依据。Pearson相关系数的计算公式为：

$$r_{xy} = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2} \sqrt{\sum_{i=1}^{n}(y_i - \bar{y})^2}}$$

关键的相关性发现包括：

- **$p_{\text{scav}}$与$P_{\text{comp}}$强正相关**（$r \approx 0.92$）：扫气压力越高，压缩终点压力越高，符合多变压缩关系$P_{\text{comp}} \propto p_{\text{scav}} \cdot \varepsilon^n$
- **RPM与$P_{\text{max}}$中等正相关**（$r \approx 0.75$）：转速升高通常伴随负荷增加
- **$P_{\text{comp}}$与$P_{\text{max}}$中等正相关**（$r \approx 0.68$）：压缩起点压力影响燃烧峰值压力

![图4-11 参数关联分析](../visualization_output/preprocessing/normalization_correlation.svg)

**图4-11 参数标准化与关联分析**：Pearson相关系数矩阵显示$p_{\text{scav}}$与$P_{\text{comp}}$强正相关（$r \approx 0.92$），这一发现支持分步校准策略——压缩过程可以独立于燃烧过程进行校准。

---

## 4.3 分步解耦三阶段校准方法

### 4.3.1 校准策略物理依据

将所有模型参数同时优化面临高维搜索空间、参数耦合、多极值问题和参数可辨识性等挑战。本模型有至少5个待校准参数，同时优化需要5维搜索，计算量大；不同参数对输出变量的影响可能相互抵消，导致非唯一解；复杂的目标函数曲面存在多个局部极小值；某些参数组合可能产生相似的输出，难以唯一确定。

分步解耦策略根据柴油机工作过程的因果层次，将校准分解为三个顺序进行的阶段：压缩过程不涉及燃烧，只与压缩比相关，作为第一阶段；燃烧过程在压缩基础上进行，与燃烧参数相关，作为第二阶段；传热过程贯穿整个循环，与Woschni系数相关，作为第三阶段。这种分解的物理基础是：压缩过程发生在燃烧之前，其效果可以通过$P_{\text{comp}}$独立评估；燃烧过程的主要特征是$P_{\text{max}}$，与压缩过程基本独立；传热对$T_{\text{exh}}$的影响最为显著，可在燃烧参数确定后调整。

![图4-12 三阶段校准流程](../visualization_output/modeling/calibration_flowchart.svg)

**图4-12 三阶段分步解耦校准流程**：参数→目标→算法的对应关系，以及各阶段之间"锁定参数"的递进策略。每个阶段完成后，将校准得到的参数锁定，在后续阶段不再调整。

**参数-输出敏感度矩阵**验证了分步策略的合理性。敏感度定义为输出变量对参数小扰动的响应：

$$S_{ij} = \frac{\partial y_i / y_i}{\partial p_j / p_j} = \frac{\partial \ln y_i}{\partial \ln p_j}$$

式中$y_i$为第$i$个输出变量（$P_{\text{comp}}$, $P_{\text{max}}$, $T_{\text{exh}}$），$p_j$为第$j$个校准参数。

![图4-13 参数敏感度雷达图](../visualization_output/modeling/sensitivity_radar.svg)

**图4-13 参数敏感度雷达图**：$P_{\text{comp}}$主要由压缩比控制（敏感度>0.8），$P_{\text{max}}$主要由燃烧参数控制（喷油正时敏感度>0.6），$T_{\text{exh}}$主要由Woschni系数控制（敏感度>0.5）。敏感度矩阵的近似对角化结构支持了分步解耦策略。

**表4-7 三阶段校准参数配置**

| 阶段 | 优化参数                                       | 搜索范围                    | 目标变量          | 误差阈值 | 优化算法 |
| ---- | ---------------------------------------------- | --------------------------- | ----------------- | -------- | -------- |
| 一   | 压缩比 $\varepsilon$                           | [11, 16]                    | $P_{\text{comp}}$ | <2%      | L-BFGS-B |
| 二   | $\theta_{\text{inj}}$, $\Delta\theta_d$, $m_d$ | [-5,10]°, [30,80]°, [0.5,3] | $P_{\text{max}}$  | <3%      | 差分进化 |
| 三   | Woschni $C$                                    | [80, 200]                   | $T_{\text{exh}}$  | <5%      | L-BFGS-B |

### 4.3.2 第一阶段：压缩过程校准

第一阶段的目标是校准有效压缩比$\varepsilon$，使模型预测的压缩终点压力与实验数据匹配。

**目标函数设计**：

采用平方相对误差作为目标函数：

$$f_1(\varepsilon) = \left( \frac{P_{\text{comp,sim}}(\varepsilon) - P_{\text{comp,exp}}}{P_{\text{comp,exp}}} \right)^2$$

选择相对误差而非绝对误差的原因是：不同工况下$P_{\text{comp}}$的数值范围不同（低负荷约80 bar，高负荷约120 bar），相对误差可以公平地评估不同工况的匹配程度。

**有效压缩比的物理意义**：

有效压缩比$\varepsilon$是一个等效参数，综合考虑了以下因素的影响：

- 几何压缩比：由气缸几何尺寸决定
- 配气正时：排气阀、扫气口的实际关闭时刻影响有效压缩行程
- 压缩多变指数：壁面传热影响压缩过程的多变指数
- 泄漏损失：活塞环泄漏会降低有效压缩比

因此，校准得到的$\varepsilon$可能与标称几何压缩比不同，这是正常的。

**优化算法：L-BFGS-B**：

L-BFGS-B（Limited-memory Broyden-Fletcher-Goldfarb-Shanno with Bound constraints）是一种适用于带边界约束的准牛顿法。其特点包括：

- 利用目标函数梯度信息，收敛速度快
- 内存占用小（只存储最近几次迭代的梯度信息）
- 支持简单边界约束（$\varepsilon \in [11, 16]$）

对于单参数优化问题，L-BFGS-B通常在15至25次迭代内收敛。梯度通过有限差分法计算：

$$\frac{\partial f_1}{\partial \varepsilon} \approx \frac{f_1(\varepsilon + \Delta\varepsilon) - f_1(\varepsilon - \Delta\varepsilon)}{2\Delta\varepsilon}$$

典型的$\Delta\varepsilon = 0.01$。

### 4.3.3 第二阶段：燃烧放热规律校准

第二阶段校准燃烧相关的三个参数：喷油正时$\theta_{\text{inj}}$、扩散燃烧持续角$\Delta\theta_d$和扩散燃烧形状因子$m_d$。

**目标函数设计**：

采用多工况平均平方相对误差：

$$f_2(\theta_{\text{inj}}, \Delta\theta_d, m_d) = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{P_{\text{max,sim}}^{(i)} - P_{\text{max,exp}}^{(i)}}{P_{\text{max,exp}}^{(i)}} \right)^2$$

式中$N$为校准工况数。使用多工况联合校准可以避免过拟合单一工况，提高参数的泛化性。

**优化算法：差分进化**：

差分进化（Differential Evolution, DE）是一种基于种群的全局优化算法，特别适合多参数、多极值问题。其基本操作包括：

1. **初始化**：在搜索空间内随机生成$NP$个个体（种群），每个个体代表一组参数值

2. **变异**：对每个目标个体$\mathbf{x}_i$，从种群中随机选择三个不同的个体$\mathbf{x}_{r1}$, $\mathbf{x}_{r2}$, $\mathbf{x}_{r3}$，生成变异个体：
   $$\mathbf{v}_i = \mathbf{x}_{r1} + F \cdot (\mathbf{x}_{r2} - \mathbf{x}_{r3})$$
   式中$F$为变异因子，控制搜索步长

3. **交叉**：将变异个体$\mathbf{v}_i$与目标个体$\mathbf{x}_i$按概率$CR$进行交叉，生成试验个体$\mathbf{u}_i$

4. **选择**：比较试验个体与目标个体的适应度，保留更优者进入下一代

**差分进化算法配置**：

| 参数     | 符号       | 取值 | 说明           |
| -------- | ---------- | ---- | -------------- |
| 种群大小 | $NP$       | 5    | 每代5个个体    |
| 变异因子 | $F$        | 0.8  | 控制搜索步长   |
| 交叉概率 | $CR$       | 0.9  | 高交叉促进探索 |
| 最大迭代 | $G_{\max}$ | 15   | 最大迭代代数   |

**收敛判据**：

算法在满足以下任一条件时终止：达到最大迭代次数$G_{\max}$、目标函数值低于阈值（相对误差<3%）、或连续5代最优解无显著改进（改进<0.1%）。

### 4.3.4 第三阶段：传热系数校准

第三阶段校准Woschni传热系数$C$，使模型预测的排气温度与实验数据匹配。

**物理机理**：

Woschni系数$C$直接影响缸内传热强度：

- 增大$C$ → 传热增强 → 更多热量传递给壁面 → $T_{\text{exh}}$降低
- 减小$C$ → 传热减弱 → 更多热量保留在工质中 → $T_{\text{exh}}$升高

这种单调关系使得$C$的校准相对简单，L-BFGS-B算法通常在10次迭代内收敛。

**目标函数**：

$$f_3(C) = \left( \frac{T_{\text{exh,sim}}(C) - T_{\text{exh,exp}}}{T_{\text{exh,exp}}} \right)^2$$

**误差阈值**：

$T_{\text{exh}}$的误差阈值设为5%，高于$P_{\text{comp}}$和$P_{\text{max}}$的阈值。这是因为排气温度测量本身存在较大不确定性（热电偶响应滞后、安装位置影响等），同时排气温度受多种因素影响（燃烧、传热、残余废气等）难以完美匹配，而在故障诊断应用中排气温度的相对变化比绝对精度更重要。

### 4.3.5 校准结果

![图4-14 校准收敛曲线](../visualization_output/calibration/calibration_exp_sim_lines.svg)

**图4-14 三阶段校准收敛曲线**：各阶段误差随迭代次数的变化，所有阶段均达到目标阈值。

**表4-5 校准后的模型参数**

| 参数             | 符号                  | 校准值 | 单位  |
| ---------------- | --------------------- | ------ | ----- |
| 有效压缩比       | $\varepsilon$         | 15.567 | -     |
| 喷油正时         | $\theta_{\text{inj}}$ | 8.823  | °BTDC |
| 扩散燃烧持续角   | $\Delta\theta_d$      | 30.343 | °     |
| 扩散燃烧形状因子 | $m_d$                 | 0.502  | -     |
| Woschni系数      | $C$                   | 130.0  | -     |

---

## 4.4 模型精度验证

### 4.4.1 验证方法

模型验证的目的是评估校准后模型的泛化性能，即在未参与校准的工况下预测能力。本研究采用留出法（Hold-out Method）进行交叉验证。数据划分策略将预处理后的数据按70%/30%的比例划分为校准集和验证集，划分时保持各RPM层的比例一致（分层划分）以避免某些工况在验证集中缺失，校准集用于参数优化，验证集仅用于性能评估。

**评估指标**：

1. **平均绝对百分比误差（MAPE）**：
   $$\text{MAPE} = \frac{1}{N} \sum_{i=1}^{N} \left| \frac{y_{\text{sim}}^{(i)} - y_{\text{exp}}^{(i)}}{y_{\text{exp}}^{(i)}} \right| \times 100\%$$

2. **最大绝对百分比误差**：
   $$\text{MaxAPE} = \max_i \left| \frac{y_{\text{sim}}^{(i)} - y_{\text{exp}}^{(i)}}{y_{\text{exp}}^{(i)}} \right| \times 100\%$$

3. **决定系数（R²）**：
   $$R^2 = 1 - \frac{\sum_i (y_{\text{exp}}^{(i)} - y_{\text{sim}}^{(i)})^2}{\sum_i (y_{\text{exp}}^{(i)} - \bar{y}_{\text{exp}})^2}$$

$R^2$越接近1，表示模型解释数据变异的能力越强。

### 4.4.2 验证结果

![图4-15 校准验证结果](../visualization_output/calibration/calibration_45degree_scatter.svg)

**图4-15 多工况校准验证结果**：左列为仿真值与实验值随工况变化的对比曲线，右列为45°诊断散点图。散点越接近对角线，表示预测越准确。三个输出变量均表现出良好的预测能力，散点分布紧密围绕对角线。

**表4-8 模型校准精度汇总**

| 参数              | MAPE  | 最大误差 | R²    | 目标阈值 | 达标 |
| ----------------- | ----- | -------- | ----- | -------- | ---- |
| $P_{\text{comp}}$ | <1.5% | <2.5%    | >0.98 | <2%      | ✓    |
| $P_{\text{max}}$  | <2.2% | <3.5%    | >0.97 | <3%      | ✓    |
| $T_{\text{exh}}$  | <3.8% | <5.0%    | >0.95 | <5%      | ✓    |

验证结果表明模型具有良好的预测精度。压缩压力的预测精度最高，MAPE<1.5%，R²>0.98，说明压缩过程建模准确。最大爆发压力的MAPE<2.2%，R²>0.97，表明燃烧模型能够准确预测不同工况下的峰值压力。排气温度的MAPE<3.8%，R²>0.95，考虑到排气温度测量的不确定性，该精度是可接受的。

### 4.4.3 敏感性分析

敏感性分析用于量化各校准参数对输出变量的影响程度，验证分步解耦策略的合理性。

**分析方法**：

对每个校准参数在其标称值附近进行±10%的扰动，计算输出变量的相对变化：

$$S_{ij} = \frac{\Delta y_i / y_i}{\Delta p_j / p_j}$$

式中$\Delta p_j / p_j = \pm 10\%$为参数扰动幅度。

![图4-16 敏感性分析](../visualization_output/calibration/calibration_bland_altman.svg)

**图4-16 校准参数敏感性分析**：热图展示各参数对输出变量的影响程度。颜色越深表示敏感度越高。敏感度矩阵的近似对角化结构验证了分步解耦策略的有效性——每个输出变量主要由一组参数控制，与其他参数的耦合较弱。

敏感性分析的主要发现如下。$P_{\text{comp}}$对$\varepsilon$高度敏感（$S > 0.8$），对其他参数不敏感（$S < 0.1$），支持第一阶段独立校准压缩比。$P_{\text{max}}$对燃烧参数敏感，其中喷油正时$\theta_{\text{inj}}$的敏感度约为0.6，持续角$\Delta\theta_d$约为0.4，形状因子$m_d$约为0.3，支持第二阶段联合校准燃烧参数。$T_{\text{exh}}$对Woschni系数$C$敏感（$S > 0.5$），对燃烧参数有中等敏感度（$S \approx 0.2$），支持在燃烧参数确定后校准传热系数。

### 4.4.4 能量平衡分析

能量平衡分析用于验证模型的热力学一致性，确保能量守恒。

![图4-17 能量桑基图](../visualization_output/modeling/energy_sankey.svg)

**图4-17 柴油机循环能量平衡桑基图**：展示燃烧放热（100%）在循环中的分配去向。

**能量分配**：

- **有效功**：约42%，转化为曲轴输出的机械功
- **壁面传热损失**：约28%，通过缸壁传递给冷却系统
- **排气损失**：约30%，随高温排气带走

这一能量分配与大型船用柴油机的典型特性相符。有效热效率约42%处于船用柴油机的正常范围（40%~50%），验证了模型能量平衡的合理性。

### 4.4.5 模型局限性与适用范围

本模型的适用范围为：工况范围RPM 50~120，负荷20%~100%；健康状态为无严重故障的正常运行状态；燃料类型为重质船用燃料油（HFO）。模型存在一定的局限性：零维模型假设准稳态，不适用于快速变负荷过程；严重泄漏或燃烧异常可能超出模型有效范围；模型为单缸模型，未考虑缸间差异。

---

## 本章小结

本章建立了面向故障诊断的船用柴油机零维热力学模型，并完成了系统的数据预处理和参数校准工作。

在模型构建方面，本章建立了完整的零维热力学模型框架，由四个模块化组件构成。几何运动学模块基于精确的曲柄连杆运动学公式计算气缸容积及其变化率，考虑了连杆比对活塞运动不对称性的影响。双Wiebe燃烧模块采用预混燃烧和扩散燃烧的加权叠加描述船用柴油机特有的"快慢结合"燃烧特点。Woschni传热模块基于经验关联式计算缸内对流换热，考虑了基础气流和燃烧附加湍流的影响。热力学求解器采用LSODA自适应算法求解能量守恒ODE，支持工质物性随燃烧分数的变化。模型输出压缩压力$P_{\text{comp}}$、最大爆发压力$P_{\text{max}}$和排气温度$T_{\text{exh}}$三个关键性能指标，可用于故障特征提取。

在数据处理方面，本章设计了系统的预处理流程，包括基于发动机运行特性的物理边界过滤、采用稳健统计方法的IQR异常值检测、基于滑动窗口标准差的稳态工况筛选、以及确保各负荷区间工况覆盖均匀的分层抽样。预处理后的数据质量显著提高，为可靠的参数校准奠定了基础。

在参数校准方面，本章提出了分步解耦的三阶段校准策略。根据柴油机工作过程的物理因果关系，将5维参数优化分解为三个子问题：第一阶段校准压缩比$\varepsilon$，以$P_{\text{comp}}$为目标，采用L-BFGS-B算法；第二阶段校准燃烧参数（$\theta_{\text{inj}}$, $\Delta\theta_d$, $m_d$），以$P_{\text{max}}$为目标，采用差分进化算法；第三阶段校准Woschni系数$C$，以$T_{\text{exh}}$为目标，采用L-BFGS-B算法。分步策略显著降低了校准复杂度，避免了高维搜索空间带来的计算困难和多极值问题。

校准结果表明模型具有良好的预测精度，$P_{\text{comp}}$误差<1.5%、R²>0.98，$P_{\text{max}}$误差<2.2%、R²>0.97，$T_{\text{exh}}$误差<3.8%、R²>0.95，三个输出变量均满足工程应用的精度要求。敏感性分析显示参数-输出敏感度矩阵呈近似对角化结构，证实了分步解耦策略的物理合理性：$P_{\text{comp}}$主要由压缩比控制，$P_{\text{max}}$主要由燃烧参数控制，$T_{\text{exh}}$主要由传热系数控制。

校准后的零维热力学模型为后续章节的故障特征提取、智能诊断和自适应控制提供了可靠的仿真平台。模型的高计算效率（单循环仿真时间毫秒级）使其特别适合作为强化学习环境，支持大规模的智能体训练。0
